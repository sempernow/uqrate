var cfg={app:{maker:"@src",svn:"@src",ver:"0.0.0",built:"2001-01-01T01:01:01Z"},loader:{appNameSpace:"𝖖",sw:"sw.js",origin:"https://swarm.foo"},base:{bModesCSV:"dev,pro",bMode:"dev",p2qRate:1e3,lockPeriod:7,logLevelsCSV:"verbose,info,globals,workers,warn,debug,focus,error,none",logLevelAllow:"info",logColorInfo:"#fff",logColorWarn:"#f69",logColorError:"#f06",logColorFocus:"#6f0",logColorDebug:"#ff0",gatewayID:{AuthorizeNet:"1"}},auth:{redirect:!0,obfuscate:!0,providers:"amazon,github,paypal,google,stripe,",modesCSRF:{SansMitigation:0,CustomAJAXHeader:1,SourceTargetHeaders:2,DoubleSubmitCookie:3,DomainLockedDouble:4,HMACCookie:5},keyTknAccess:"a",keyTknRefresh:"r",keyRefAccess:"_a",keyRefRefresh:"_r",keyCSRF:"_c",keyOA:"_o",TLS:"true"},state:{apisCSV:"none"},eb:{eTypes:[,"Loader","Net","Action","State","View","MsgListMenu","CentreMenu","Auth","Txn","Modal"]},net:{domain:"swarm.foo",originAOA:"swarm.foo",originAPI:"swarm.foo",originPWA:"swarm.foo",rootAOA:"https://swarm.foo",rootAPI:"https://swarm.foo",rootPWA:"https://swarm.foo",baseAOA:"/aoa/v1",baseAPI:"/api/v1",basePWA:"",uriDefault:"/app/centre",msgListFull:"100",msgListDiff:"22"},view:{oauthSvcRoot:"http://swarm.foo/aoa/v1/o",svgsPath:"",svgLogoDef:"#def-token-q",banners:"https://cdn.uqrate.org/media/banners",avatars:"https://cdn.uqrate.org/media/avatars",avatarDefault:"",timeTransientFX:3e4,chn:{},header:{maxWidth:"920px",logoResizeTrigger:"35"},logo:{target:"#def-app-logo",duration:"4000",delay:"0"},msgs:{menuActive:"Threads",collapseAll:!1,svgsPath:"",maxShort:256,maxLong:8192,minQ4P:3},badgeList:[]}};const __APP__=cfg.loader.appNameSpace;cfg.net.basePWA="/"===cfg.net.basePWA?"":cfg.net.basePWA,cfg.auth.providers=cfg.auth.providers.slice(0,cfg.auth.providers.length-1),cfg.view.badgeList=[],function(e,t){"use strict";"cfg"in e||(e.cfg=cfg,cfg=void 0)}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e,t){"use strict";e.cfg=e.cfg?e.cfg:{base:{bModesCSV:"test,prod",bMode:"test",p2qRate:1e3,lockPeriod:30,logLevelsCSV:"verbose,info,globals,workers,warn,error,focus,debug,none",logLevelAllow:"info"},net:{},view:{badgeList:[]}};const s=e.cfg.base;{e.Models={Unknown:0,Message:1,Channel:2,User:3,Group:4,SponSub:5},e.ModelName=t=>Object.keys(e.Models).filter(s=>e.Models[s]===t)[0]||"Unknown",e.ReduceToListOfKey=(e,t)=>e.reduce((e,s)=>(e.push(s[t]),e),[]),e.Lists={},Object.keys(e.Models).map(t=>e.Lists[`${t.toLowerCase()}s`]=e.Models[t]),e.ListName=t=>Object.keys(e.Lists).filter(s=>e.Lists[s]===t)[0]||"unknowns",e.lTypes={unknown:0,chn:1,pub:2,sub:3,th:4,newest:5,trending:6,popular:7,valued:8,paid:9,owned:10},e.lTypeName=(t=0)=>Object.keys(e.lTypes).filter(s=>e.lTypes[s]===t)[0]||"unknown",e.vTypes={self:0,page:1,shell:2,partial:3,diff:4},e.Privacy={All:0,Members:1,SubersFree:2,SubersPaid:3,GrpMembers:4,GrpLeaders:5,Recipient:6,Self:7,Hidden:8,Ops:9},e.mForm={short:1,long:2},e.aModes={replay:0,mutate:1,promise:2,merge:3},e.sModes={UNK:0,API:1,PWA:2},e.sModeName=(t=0)=>Object.keys(e.sModes).filter(s=>e.sModes[s]===t)[0]||"UNK",e.dTypes={full:"full",diff:"diff",update:"update",scroll:"scroll"},e.AuthModes={SignUp:"SU",BasicAuth:"BA",ObfuscateBA:"OB",DigestAuth:"DA",OAuth2:"OA",WebAuthn:"WA"},e.TknTypes={tknR:"R",tknA:"A"},e.TxnXIS=e.Models,e.TxnAct={Punish:0,Sponsor:1,Subscribe:2,P2q:3,ExchZero:4,ExchBuyin:5,ExchPayout:6},e.toContextIndexed=(e,t=window,s="")=>e.split(",").map((e,a)=>t[s+e.toUpperCase()]=a+1),e.toContextIndexed(s.bModesCSV,e.bModes={}),e.bMode=e.bModes[s.bMode.toUpperCase()]||e.bModes.PROD,e.LockPeriod=e.bMode===e.bModes.TEST?0:e.cfg.base.lockPeriod,e.getID=e=>e.substring(2);const{rootAOA:t,baseAOA:a,rootAPI:n,baseAPI:o,rootPWA:r,basePWA:i}=e.cfg.net;e.urlAOA=e=>`${t}${a}${e}`,e.urlAPI=e=>`${n}${o}${e}`,e.urlPWA=e=>`${r}${i}${e}`,e.badgeList=e.cfg.view.badgeList.reverse(),e.getBadges=t=>e.badgeList.filter(e=>t&Math.pow(2,+e.bit)),e.getGlyphs=t=>e.getBadges(t).map(e=>e.glyph),e.makeBadgeNodes=t=>e.getBadges(t).map(e=>`<span title="${e.name+(e.dscr?": "+e.dscr:"")}">${e.glyph}</span>`),e.name=__APP__||"FAILs",e.utfDEL="␡"}"function"!=typeof HTMLCollection.prototype[Symbol.iterator]&&(HTMLCollection.prototype[Symbol.iterator]=function(){let e=0;return{next:()=>({done:e>=this.length,value:this.item(e++)})}}),Element.prototype.closest||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(this))return null;do{if(t.matches(e))return t;t=t.parentElement}while(null!==t);return null});{const t=e=>Object.prototype.toString.call(e);e.isType=t,e.isFunction=e=>"[object Function]"===t(e),e.isObject=e=>"[object Object]"===t(e),e.isArray=e=>"[object Array]"===t(e),e.isPromise=e=>"[object Promise]"===t(e),e.isString=e=>"[object String]"===t(e),e.isNumber=e=>"[object Number]"===t(e),e.isAlphaNum=e=>/^[a-z0-9]+$/i.test(e),e.isDigits=e=>/^\d+$/.test(e),e.objNameToString=e=>Object.keys({x:e})[0],e.has=(t,s)=>e.isObject(t)&&t.hasOwnProperty(s)||e.isArray(t)&&t.includes(s),e.fnameURI=function(e){return"string"!=typeof e?"":(e=decodeURI(e)).substring(e.lastIndexOf("/")+1)||""}}e.uuidv4=()=>{switch(!(!window.crypto&&!window.msCrypto)){case!0:return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16));case!1:return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}},e.uuid_nil="00000000-0000-0000-0000-000000000000",e.digest=async(e,t)=>{if(!crypto.subtle)return!1;const s=(new TextEncoder).encode(t),a=await crypto.subtle.digest(e,s);return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")},e.sha1=t=>e.digest("SHA-1",t),e.sha256=t=>e.digest("SHA-256",t),e.sha512=t=>e.digest("SHA-512",t),e.randInt=e=>Math.floor(Math.random()*(e+1)),e.rand=(e=20)=>{const t=[],s=Math.floor(e/11)+e%11;for(let e=0;e<=s;e++)t.push(Math.random().toString(36).substring(2,15));return t.join("").substring(0,e)},e.base64Encode=e=>btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t))),e.base64Decode=e=>decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")),e.base64urlEncode=e=>self.btoa(e).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,""),e.base64urlDecode=e=>{var t=(e=e.replace(/-/g,"+").replace(/_/g,"/")).length%4;if(t){if(1===t)throw new Error("Invalid Length");e+=new Array(5-t).join("=")}return self.atob(e)},e.dec2bin=e=>+(e>>>0).toString(2),e.xor=(e,t)=>{const s=t.length;return Array.prototype.slice.call(e).map((e,a)=>String.fromCharCode(e.charCodeAt(0)^t[a%s].charCodeAt(0))).join("")},e.rev=t=>e.isString(t)?t.split("").reverse().join(""):t,e.replaceAll=(e,t,s)=>e?e.split(t).join(s):"",e.parseJWT=t=>{if(!e.isString(t))return!1;const s=t.split(".");return!(s.length<3)&&{header:JSON.parse(e.base64urlDecode(s[0])),payload:JSON.parse(e.base64urlDecode(s[1])),signature:e.base64urlDecode(s[2])}},e.parse=e=>{if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(t){return{data:e,err:t}}},e.aParse=e=>{if("string"!=typeof e)return Promise.resolve(e);try{return Promise.resolve(JSON.parse(e))}catch(t){return Promise.reject({data:e,err:t})}},e.clone=t=>e.parse(JSON.stringify(t)),e.arrSeq=(e,t=1)=>[...Array(t+e).keys()].slice(t),e.arrCopy=e=>e.slice(),e.arrsConcat=(e,t)=>e.push.apply(e,t),e.dedup=e=>[...new Set(e)],e.arrDiff=(e,t)=>{var s;const a=e.length,n=t.length,o=[];if(!a)return t;if(!n)return e;for(s=0;s<a;s++)-1===t.indexOf(e[s])&&o.push(e[s]);for(s=0;s<n;s++)-1===e.indexOf(t[s])&&o.push(t[s]);return o},e.nowSec=()=>Math.floor(e.nowMsec()/1e3),e.nowMsec=()=>Math.floor((new Date).getTime()),e.nowISO=()=>(new Date).toISOString(),e.nowUTC=()=>(new Date).toUTCString(),e.UTCtoSec=e=>Math.floor(new Date(e).getTime()/1e3),e.UTCtoMsec=e=>new Date(e).getTime(),e.DateStrToEpoch=t=>e.UTCtoMsec(t),e.toTimes=(...e)=>[...e].map(e=>(isNaN(e)&&(e=parseInt(e,10)),e.toString().length>11&&(e=Math.floor(e/1e3)),e)),e.toTimesMsec=(...e)=>[...e].map(e=>(isNaN(e)&&(e=parseInt(e,10)),e.toString().length<=11&&(e=Math.floor(1e3*e)),e)),e.time2ISO=t=>new Date(e.toTimesMsec(t)[0]).toISOString(),e.time2UTC=t=>new Date(e.toTimesMsec(t)[0]).toUTCString(),e.ttl=t=>{if(isNaN(t))return 0;const s=e.UTCtoSec(e.nowUTC());return t>s?t-s:0},e.ageDelta=(t,s)=>{if([t,s]=e.toTimes(t,s),isNaN(t-s))return"age unknown";const a=t-s;var n,o;return a<6?"just now":(a<54?(n=Math.round(a),o="second"):a<3240?(n=Math.round(a/60),o="minute"):a<77760?(n=Math.round(a/3600),o="hour"):a<2332800?(n=Math.round(a/86400),o="day"):a<27993600?(n=Math.round(a/2592e3),o="month"):(n=Math.round(a/31104e3),o="year"),n+(n>1?` ${o}s`:` ${o}`)+" ago")},e.ageNow=t=>e.ageDelta(e.nowSec(),t),e.sleep=function(e){let t=Date.now();for(;!(Date.now()-t>e););},e.aSleep=function(e){return new Promise(t=>setTimeout(t,e))},e.delay=e.sleep,e.Delay=e.sleep,e.aDelay=(e,t,...s)=>{if("function"==typeof t)return setTimeout(()=>t.apply(this,s),e)},e.seq125=(e=1,t=4,s=!1)=>{var a=[1,2,5],[n,o]=[-1,-1];return function(){return++n%3==0&&o++,o!==t||s||([n,o]=[0,0]),e*a[n%3]*Math.pow(10,o)}},e.seqArr=(e,t=4,s=!1)=>{var[a,n]=[-1,-1];return function(){return++a%e.length==0&&n++,n>t&&([a,n]=s?[0,t]:[0,0]),e[a%e.length]*Math.pow(10,n)}},e.waitUntil=function t(s,a,n,...o){if(!s()){var r=a();return e.bMode!==e.bModes.PROD&&console.log(`${e.name}%c [${e.nowISO().substring(17)}] waitUntil @ ${n.name}() awaiting '${s.name}' : ${r} ms ...`,"color:#0ff;"),e.aDelay(r,()=>t(s,a,n,...o))}n(...o)},e.aScheduleSeq=(t,s,...a)=>{var n=t();return e.aDelay(n,()=>s(...a)),e.aDelay(n,()=>e.aScheduleSeq(t,s,...a))},e.aScheduler=(t,s)=>(function(...a){return e.aDelay(t,s,...a)}),e.aSchedulerP=(e,t,s)=>(function(...a){return s&&s.aborted?Promise.reject(new DOMException("Aborted","AbortError")):new Promise((a,n)=>{setTimeout(()=>a(t),e),s&&s.addEventListener("abort",()=>{n(new DOMException("Aborted","AbortError"))})}).then(e=>e(...a))});{const t=new AbortController;e.aSchedulerP.signal=t.signal,e.aSchedulerP.abort=()=>t.abort()}e.throttle=function(e,t){let s=!0;return function(...a){s&&(s=!1,t.apply(this,a),setTimeout(()=>s=!0,e))}},e.debounce=function(e,t){let s;return function(...a){clearTimeout(s),s=setTimeout(()=>t.apply(this,a),e)}},e.once=(e,t)=>{var s;return function(){return e&&(s=e.apply(t||this,arguments),e=null),s}},e.rAF=e=>window.requestAnimationFrame(e),e.rIC=(e,t=0)=>window.requestIdleCallback(e,{timeout:t}),e.toDOM=(e,t,s=!1)=>(s=s?"afterbegin":"beforeend",!(!e||!t)&&(e.insertAdjacentHTML(s,t),!0)),e.toDOMrAF=(t,s,a=!1)=>(a=a?"afterbegin":"beforeend",!(!t||!s)&&e.rAF(()=>t.insertAdjacentHTML(a,s))),e.create=e=>document.createElement(e),e.prepend=(e,t,s)=>e.insertBefore(t,s),e.append=(e,t)=>e.appendChild(t),e.del=e=>e.remove(),e.purge=e=>{if(!e)return!1;for(;e.firstChild;)e.removeChild(e.firstChild)},e.stripAnchor=t=>{const s=e.create("DIV");s.innerHTML=t;const a=e.css("A",s);return a?a.innerHTML:t},e.getText=e=>e&&e.textContent,e.setText=(e,t)=>e&&(e.textContent=t),e.replaceText=(e,t,s)=>e&&e.textContent.replace(t,s),e.id=e=>document.getElementById(e),e.css=(e,t)=>(t=t||document).querySelector(e),e.cssAll=(e,t)=>(t=t||document).querySelectorAll(e),e.class=(e,t)=>(t=t||document).getElementsByClassName(e),e.tags=(e,t)=>(t=t||document).getElementsByTagName(e),e.ancestor=(e,t)=>e.closest(t),e.required=(e=[],t=!0)=>e.map(e=>t?e.required=t:e.removeAttribute("required")),e.getRect=e=>{const{top:t,right:s,bottom:a,left:n,width:o,height:r,x:i,y:l}=e.getBoundingClientRect();return{top:t,right:s,bottom:a,left:n,width:o,height:r,x:i,y:l}},e.top=e=>Math.round(e.getBoundingClientRect().top),e.stripTags=t=>{const s=e.create("DIV");return s.innerHTML=t,s.textContent||s.innerText||""},e.scrollPagePct=()=>Math.round((window.innerHeight+window.scrollY)/document.body.offsetHeight*100),e.copyToClipboard=e=>(e.focus(),e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value)),e.profile=(t="prof",s,a=!0)=>{var n,o;return{start:t=>{e.bMode!==e.bModes.PROD&&(t===e.log.profOFF&&(a=!1),a&&(n=performance.now()))},stop:()=>{e.bMode!==e.bModes.PROD&&a&&(o=performance.now(),(s=s||(e=>console.log(`%c${e}`,"color:#0ff;")))(`Δt @ ${t} : `+(o-n)+" ms"))}}};{const t=(()=>{const t={},{logLevelsCSV:a,logColorInfo:n,logColorWarn:o,logColorError:r,logColorFocus:i,logColorDebug:l}=s;e.toContextIndexed(a,t);const d=s.logLevelAllow?s.logLevelAllow:t.INFO;return{init:function(s,c){var u;return s||(s=e.name),c=function(e){e||(e=t.INFO);const s=function(e){return a.split(",").reduce((t,s,a)=>(s===e&&(t=a+1),t),0)}(d);return e>=s?e:0}(c),function(a,...d){if(!c||""===a)return;var h,p;switch(c){case t.WARN:h=" WARN :",p=o;break;case t.ERROR:h=" ERR :",p=r;break;case t.FOCUS:h=" FOCUS :",p=i;break;case t.DEBUG:if(e.bMode===e.bModes.PROD)return;if(a===e.log.debugOFF&&(u=!0),u)return;h=" DEBUG :",p=l;break;default:h="",p=n}const g=e.name+" ["+e.nowISO().substring(17,23)+"] ["+s+"]";return console.log(`%c${g+h}`,`color:${p}`,a,...d),arguments}},levels:t}})();e.log=t.init,e.log.levels=t.levels,e.log.debugOFF="___FLAG_DEBUG_OFF___",e.log.profOFF="___FLAG_PROF_OFF___",e.logErr=t=>e.log(t,e.log.levels.ERROR),e.logDeb=t=>e.log(t,e.log.levels.DEBUG),e.logFocus=t=>e.log(t,e.log.levels.FOCUS),e.logWarn=t=>e.log(t,e.log.levels.WARN)}e.Page=()=>({domain:document.domain,URL:document.URL,documnetURI:document.documentURI,lastModified:document.lasModified,referrer:document.referrer,location:window.location,top:window.top,parent:window.parent,opener:window.opener,embedded:window!==window.top}),e.removeHash=()=>"pushState"in history?history.pushState("",document.title,window.location.pathname+window.location.search):window.location.hash="",e.cType={html:"text/html",text:"text/plain",json:"application/json",svg:"image/svg+xml"},e.aFetch=t=>{const s={req:t,url:"",cType:"",status:0,statusText:""};return fetch(t).then(a=>{const n=a.status>299&&a.status<400?a.headers.get("Location"):void 0,o=a.headers.get("Content-Type")||t.headers.get("Accept"),r=e.isString(o)?o.split(";")[0]:e.cType.text;s.status=a.status,s.statusText=a.statusText,s.url=a.url,s.req=t,s.cType=r,s.loc=n;const i={body:!1,meta:s};if(!((a.status<300||a.status>=200)&&204!==a.status))return i;switch(r){case e.cType.json:i.body=a.json();break;case e.cType.text:case e.cType.html:case e.cType.svg:default:i.body=a.text()}return i}).then(e=>Promise.all([e.body,e.meta])).then(e=>Promise.resolve({body:e[0],meta:e[1]})).catch(e=>{return Promise.reject((e=>{switch(!0){case-1!==e.toString().indexOf("TypeError: NetworkError when"):case-1!==e.toString().indexOf("TypeError: Failed to fetch"):return{req:t,status:111,statusText:"Offline",err:e};default:return{req:t,status:999,statusText:"Rejected",err:e}}})(e))})}}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e,t){"use strict";const s=Math.floor(Math.random()*Math.floor(999)),a=(e.log("EB"),e.log("EB",e.log.levels.DEBUG)),n=e.log.debugOFF,o=(e.log("EB",e.log.levels.FOCUS),e.log("EB",e.log.levels.WARN),e.log("EB",e.log.levels.ERROR)),r=e.bMode===e.bModes.TEST,i=e.isFunction,l={subs:{},pubs:{},eTypes:{}},d={id:s},c=e=>l.eTypes[e]||!1,u=e=>l.subs[e]||!1,h=async e=>(e.t0=performance.now(),e.rtn=e.fn(e.args),e.rtn=await e.rtn?await e.rtn:e.rtn,e.fn=e.fn.fn?e.fn.fn:e.fn.name,e.t1=performance.now(),await e),p=e=>({add:t=>i(t)?c(e)?(u(e)?u(e).add(t):(e=>c(e)&&(u(e)||(l.subs[e]=new Set)))(e).add(t),r&&a("on ::",{eType:e,fn:t}),!0):(o("@ add(fn) :: The eType is NOT REGISTERED:",{eType:e,fn:t}),!1):(o("@ add(fn) :: The arg is NOT a FUNCTION:",{eType:e,fn:t}),!1),rem:t=>{let s=u(e);return!!(!t||s&&s.has(t))&&(a("off ::",t&&r?{eType:e,fn:t.name}:{eType:e,fn:"All"}),Promise.resolve().then(()=>{s.delete(t),0!==s.size&&void 0!==t||s.clear()}).catch(o),!0)}});d.peek=()=>{const e={};for(var t in l.subs){const s=[];l.subs[t].forEach(e=>s.push(e)),e[t]=s}e.eTypes=Object.keys(l.subs),Object.defineProperty(e,"eTypes",{enumerable:!1});const s=Object.keys(l.eTypes);return{subs:e,pubs:l.pubs,eTypes:s}},d.reg=e=>l.eTypes[e]||(l.eTypes[e]=Symbol(e)),d.eTypes=()=>d.peek().eTypes.reduce((e,t)=>(e[t]=t,e),{}),d.sub=(e,t)=>p(e).add(t),d.off=(e,t)=>p(e).rem(t),d.pub=async(e,t)=>{if(!u(e))return!1;const s=await Promise.all(((e,t)=>[...u(e)].map(s=>({eType:e,fn:s,args:t})))(e,t).map(h));return r&&(e=>e.map(e=>{if(!a)return;const t=e.eType;return e.ms=e.t1-e.t0,delete e.eType,delete e.t0,delete e.t1,e.time=new Date,e.time=e.time.toISOString().substring(11),!l.pubs[t]&&(l.pubs[t]={total:0,consumed:[]}),l.pubs[t].total+=1,l.pubs[t].consumed.length>9&&l.pubs[t].consumed.shift(),l.pubs[t].consumed.push(e),r&&a(`emit :: ${t} ::`,{ms:e.ms,fn:e.fn,args:e.args}),e}))(s),s},a(n),e.EB=()=>d,(()=>{const t=e.cfg.eb,s=e.EB(),a=t.eTypes,n=e.log("eTypes",e.log.levels.DEBUG),o=(e.log("eTypes",e.log.levels.ERROR),e.bMode,e.bModes.TEST,e.log.debugOFF);a.map(s.reg),n(o),n("eb.id",s.id),n("cfg.eTypes",a),n("eb.eTypes()",s.eTypes()),n("eb.peek()",s.peek())})()}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var s=window.Cookies,a=window.Cookies=e();a.noConflict=function(){return window.Cookies=s,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var s=arguments[e];for(var a in s)t[a]=s[a]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function s(a){function n(){}function o(t,s,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},n.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var r=JSON.stringify(s);/^[\{\[]/.test(r)&&(s=r)}catch(e){}s=a.write?a.write(s,t):encodeURIComponent(s+"").replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(t+"").replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var i="";for(var l in o)o[l]&&(i+="; "+l,!0!==o[l]&&(i+="="+o[l].split(";")[0]));return document.cookie=t+"="+s+i}}function r(e,s){if("undefined"!=typeof document){for(var n={},o=document.cookie?document.cookie.split("; "):[],r=0;r<o.length;r++){var i=o[r].split("="),l=i.slice(1).join("=");s||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var d=t(i[0]);if(l=(a.read||a)(l,d)||t(l),s)try{l=JSON.parse(l)}catch(e){}if(n[d]=l,e===d)break}catch(e){}}return e?n[e]:n}}return n.set=o,n.get=function(e){return r(e,!1)},n.getJSON=function(e){return r(e,!0)},n.remove=function(t,s){o(t,"",e(s,{expires:-1}))},n.defaults={},n.withConverter=s,n}((function(){}))})),function(e,t){if("undefined"==typeof Cookies)return!1;const s=Cookies.noConflict(),a=(e.log("cookies"),e.log("cookies",e.log.levels.ERROR),e.cfg.net.domain),n=e.cfg.auth.TLS;e.Cookies={},e.Cookies.set=(e,t,o=3,r="/",i=a,l="strict",d=n)=>""!==e&&("string"==typeof e&&(void 0!==t&&("string"!=typeof t&&(t=JSON.stringify(t)),s.set(e,t,{expires:o,path:r,domain:i,sameSite:l,secure:d}),!!s.get(e)))),e.Cookies.get=e=>{const t=s.get(e);var a;if("string"==typeof t)try{a=JSON.parse(t)}catch(e){a=t}else a={},"object"==typeof t&&Object.keys(t).map(e=>{try{a[e]=JSON.parse(t[e])}catch(s){a[e]=t[e]}}),0===Object.keys(a).length&&(a=!1);return a},e.Cookies.keys=()=>Object.keys(s.get()),e.Cookies.del=(...e)=>{void 0===e[0]&&(e=[]);const t=[];return e=e.length?e:Object.keys(s.get()),[...e].map(e=>{s.get(e)&&t.push(e),s.remove(e,{path:"/",domain:a,secure:n,sameSite:"strict"})}),t}}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";if("undefined"==typeof localStorage)return!1;if("undefined"==typeof sessionStorage)return!1;function s(e,t,s,a){return JSON.stringify(e,function(e,t){var s=[],a=[];null==t&&(t=function(e,t){return s[0]===t?"[Circular ~]":"[Circular ~."+a.slice(0,s.indexOf(t)).join(".")+"]"});return function(n,o){if(s.length>0){var r=s.indexOf(this);~r?s.splice(r+1):s.push(this),~r?a.splice(r,1/0,n):a.push(n),~s.indexOf(o)&&(o=t.call(this,n,o))}else s.push(o);return null==e?o:e.call(this,n,o)}}(t,a),s)}e.log("storage");const a=e.log("storage",e.log.levels.ERROR),n=(e.isObject,e.isArray,e=>{if(!e)return o();var t,s=localStorage.getItem(e);try{t=JSON.parse(s)}catch(t){a("@ getObj :: k:",e,"v:",s,t)}return null===s&&null===t&&(s=void 0),t||s}),o=()=>{for(var e={},t=0;t<localStorage.length;t++)e[localStorage.key(t)]=n(localStorage.key(t));return e};e.Storage={},e.Storage.set=(e,t)=>{if(""===e)return!1;if("string"!=typeof e)return!1;if(void 0===t)return!1;return t=s(t),localStorage.setItem(e,t),!!localStorage.getItem(e)},e.Storage.get=n,e.Storage.keys=()=>{const e=[];for(var t=0;t<localStorage.length;t++)e.push(localStorage.key(t));return e},e.Storage.del=(...t)=>{void 0===t[0]&&(t=[]);const s=[];return t.length||(t=e.Storage.keys()),t.map(e=>{localStorage.getItem(e)&&s.push(e),localStorage.removeItem(e)}),s},e.Storage.clear=()=>localStorage.clear()||sessionStorage.clear()||!0}(window[__APP__]=window[__APP__]||{}),"function"!=typeof JSON.decycle&&(JSON.decycle=function(e,t){"use strict";var s=new WeakMap;return function e(a,n){var o,r;return void 0!==t&&(a=t(a)),"object"!=typeof a||null===a||a instanceof Boolean||a instanceof Date||a instanceof Number||a instanceof RegExp||a instanceof String?a:void 0!==(o=s.get(a))?{$ref:o}:(s.set(a,n),Array.isArray(a)?(r=[],a.forEach((function(t,s){r[s]=e(t,n+"["+s+"]")}))):(r={},Object.keys(a).forEach((function(t){r[t]=e(a[t],n+"["+JSON.stringify(t)+"]")}))),r)}(e,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach((function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}})):Object.keys(value).forEach((function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}})))}($),$});var idbKeyval=function(e){"use strict";class t{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((s,a)=>{const n=indexedDB.open(e,1);n.onerror=()=>a(n.error),n.onsuccess=()=>s(n.result),n.onupgradeneeded=()=>{n.result.createObjectStore(t)}})}_withIDBStore(e,t){return this._dbp.then(s=>new Promise((a,n)=>{const o=s.transaction(this.storeName,e);o.oncomplete=()=>a(),o.onabort=o.onerror=()=>n(o.error),t(o.objectStore(this.storeName))}))}}let s;function a(){return s||(s=new t),s}return e.Store=t,e.get=function(e,t=a()){let s;return t._withIDBStore("readonly",t=>{s=t.get(e)}).then(()=>s.result)},e.set=function(e,t,s=a()){return s._withIDBStore("readwrite",s=>{s.put(t,e)})},e.del=function(e,t=a()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},e.clear=function(e=a()){return e._withIDBStore("readwrite",e=>{e.clear()})},e.keys=function(e=a()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)},e}({});!function(e,t){"use strict";if(!window.indexedDB)return!1;if(void 0===idbKeyval)return!1;const s=window.idbKeyval;window.idbKeyval=void 0;e.log("idb");const a=e.log("idb",e.log.levels.ERROR),n=s,o=t=>{const s=e=>{if("string"!=typeof e)return Promise.resolve(e);try{return Promise.resolve(JSON.parse(e))}catch(t){return Promise.resolve(e)}};return{keys:()=>n.keys(t),get:a=>a?n.get(a,t).then(s):a?void 0:e.IDB.getA(),getA:e=>e?n.get(e,t).then(s):e?void 0:n.keys(t).then(e=>_PromiseArray(e)),getO:e=>{return e?n.get(e,t).then(s):e?void 0:n.keys(t).then(e=>(e=>Promise.all(e.map(e=>n.get(e,t).then(s).catch(e=>a("@ get0",e)))))(e).then(t=>t.map((t,s)=>({[e[s]]:t})))).then(e=>e.reduce((e,t)=>{const s=Object.keys(t)[0];return e[s]=t[s],e},{}))},set:(e,s)=>e?(s=JSON.stringify(s),n.set(e,s,t).then(()=>n.get(e,t)).then(e=>!!e).catch(e=>a("@ set",e))):Promise.resolve(!1),del:e=>(e?n.del(e,t):n.clear(t),Promise.resolve(!0))}};e.IDB=(e="s")=>{const t=new n.Store(`db-${e}`,`store-${e}`);return o(t)}}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s="Store",a=(e.log(s),e.log(s,e.log.levels.ERROR),e.log(s,e.log.levels.DEBUG)),n=e.clone;e.Store=(()=>{const t={};return function(s="state",...a){return t[s]?t[s]:t[s]=((t,...s)=>{const a="none,cookie,storage,idb,sql,cache".split(","),o={none:()=>{const e={};return{api:"none",set:(t,s)=>"string"==typeof t&&(e[t]=n(s)),get:t=>n(t?e[t]:e),del:(...t)=>[...t].map(t=>delete e[t]),keys:()=>Object.keys(e)}},cookie:()=>void 0!==e.Cookies&&(e.Cookies.set("validate","1"),void 0!==e.Cookies.get("validate")&&(e.Cookies.del("validate"),{api:"cookie",set:(t,s)=>e.Cookies.set(t,s),get:t=>e.Cookies.get(t),del:(...t)=>e.Cookies.del(...t),keys:()=>e.Cookies.keys()})),storage:()=>void 0!==e.Storage&&(e.Storage.set("validate",1),void 0!==e.Storage.get("validate")&&(e.Storage.del("validate"),{api:"storage",set:(t,s)=>e.Storage.set(t,s),get:t=>e.Storage.get(t),del:(...t)=>e.Storage.del(...t),keys:()=>e.Storage.keys()})),idb:()=>{if(void 0===e.IDB)return!1;const s=e.IDB(t);return{api:"idb",set:(e,t)=>s.set(e,t),get:e=>s.getO(e),del:e=>s.del(e),keys:()=>s.keys()}},sql:()=>!1,cache:()=>!1};return(s=>{const n=(s=s.length?s:a)[s.length-1],r=e=>o[e]();var i=void 0;o.hasOwnProperty(n)&&r(n)&&(i=r(n))||s.map(e=>o.hasOwnProperty(e)&&!1!==r(e)&&(i=r(e)));const l={},d=i||o.none();return d.name=t,e.toContextIndexed(a.join(),l),l[d.api.toUpperCase()]<l.IDB?d.mode="synch":d.mode="async",d})(s)})(s,...a)}})(),a(e.log.debugOFF)}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";e.log("AuthStore"),e.log("AuthStore",e.log.levels.ERROR),e.log("AuthStore",e.log.levels.DEBUG);e.AuthStore=()=>(()=>{const t=e.Store("auth","storage","idb");switch(t.mode){case"synch":return{mode:t.mode,api:t.api,set:(e,s)=>Promise.resolve(t.set(e,s)),get:e=>Promise.resolve(t.get(e)),del:(...e)=>Promise.resolve(t.del(...e)),keys:()=>Promise.resolve(t.keys())};case"async":return t}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.cfg.state,a=e.log("State",e.log.levels.INFO),n=e.log("State",e.log.levels.ERROR),o=e.log("State",e.log.levels.WARN),r=e.log("State",e.log.levels.DEBUG),i=(e.log("State",e.log.levels.FOCUS),e.log.debugOFF),l=e.log.profOFF,d=e.EB(),c=d.eTypes(),{clone:u,aDelay:h,nowSec:p,nowMsec:g,nowISO:m,time2UTC:f,UTCtoMsec:w,isObject:v,dTypes:y,aModes:b,waitUntil:_,seq125:T,arrsConcat:A,profile:S,has:k}=e,P=e.Store("state",...s.apisCSV.split(",")),x={time:g()},L={key:"",status:1,store:{},logs:[],cursor:void 0,get:e=>(e=(e=isNaN(e)?L.logs.length-1:e)<0?0:e,v(L.logs[e])?L.logs[e]:Object.assign(x,{init:"NOT GOOD : state.get() was called before commit() set cursor."}))},O=()=>L.status,E=t=>({model:e.ModelName(t.model),list:e.ListName(t.model),type:e.lTypeName(t.type),mode:e.sModeName(t.mode)}),M=e=>{if(!e.lists)return e;e.active=E(e.meta);const t=e.active.list,s=e.active.type;return e.lists[t][s]&&(e.list=e.lists[t][s],delete e.lists),e},$=t=>{if(t.newer.mode===b.replay)return t;if(!t.newer.data.list)return t;const s=t.newer.data;var a;switch(s.meta.model){case e.Models.Message:a="msg_id";break;case e.Models.Channel:a="chn_id";break;case e.Models.Group:a="grp_id";break;default:return Promise.reject({why:"Unsupported Model",what:s.meta,where:"renormNewer(..)"})}return s.list.map(e=>{e.date=w(e.date_create),e.id=e[a],delete e[a]}),s.active=E(s.meta),s.meta.list=s.active.list,s.meta.type>=e.lTypes.newest&&(s.centre=!0),t.newer.data=s,t},C=t=>{if(t.newer.mode===b.replay)return t;if(!t.newer.data.list)return t;const s=S("State : dedup");s.start(l);const a=t.newer.data,n=a.active.list,o=a.active.type,r=t.cache.lists&&t.cache.lists[n]&&t.cache.lists[n][o]?t.cache.lists[n][o]:[];r.sort((e,t)=>e.date-t.date),a.list.sort((e,t)=>e.date-t.date);const i=e.ReduceToListOfKey(r,"id"),d=e.ReduceToListOfKey(a.list,"id");return i.reverse().map(e=>{const t=d.indexOf(e);t>=0&&a.list.splice(t,1)}),a.list.length||(delete a.list,delete a.centre),t.newer.data=a,s.stop(),t},D=t=>{if(t.newer.mode===b.replay)return t;const s=t.newer.data.txn;if(s){const a=t.cache.lists&&t.cache.lists.active,n=a?t.cache.lists[a.list][a.type]:[],o=t=>(t.id=t.msg_id,t.date=e.UTCtoMsec(t.date_create),delete t.msg_id,t);n.map((e,t)=>e.id===s.msg_id&&(n[t]=o(s)))}return t},N=e=>e.newer.mode===b.replay?e:(e.newer.data.owner||(e.newer.data.owner=e.cache.owner),e.newer.data.channel||(e.newer.data.channel=e.cache.channel),e),R=e=>e.newer.mode===b.replay?e:e.newer.data.owner&&e.newer.data.channel?`${e.newer.data.owner.handle}/${e.newer.data.channel.slug}`!==L.key?Promise.reject({why:"handle/slug DOES NOT MATCH state.key",what:e.newer.data,where:"validate : newer"}):e:Promise.reject({why:"got.newer.data is MISSING channel and/or owner KEYs",what:e.newer.data,where:"validate : newer"}),I=e=>(L.cursor=L.logs.length,e.newer.data.cursor=L.cursor,e),F=t=>{if(t.newer.mode===b.replay)return t;if(""===L.key)return Promise.reject({why:"No key.",what:t,where:"updateStore"});const s=S("State : updateStore");return s.start(l),P.set(L.key,(t=>{if(!v(t.newer.data))return t;const s=S("State : merge"),a=t.cache,n=t.newer.data;if(s.start(l),Object.keys(n).map(e=>"list"!==e&&(a[e]=n[e])),n.list){const t=n.active.list,s=n.active.type;a.lists||(a.lists={}),a.lists[t]||(a.lists[t]={}),a.lists.active=n.active,a.lists[t][s]?e.isArray(a.lists[t][s])&&A(a.lists[t][s],n.list):a.lists[t][s]=n.list,a.lists[t][s].sort((e,t)=>e.date-t.date);const o=a.lists[t][s].filter(e=>e.author_id==a.channel.owner_id&&!e.to_id),r={count:a.lists[t][s].length||0,oldest:a.lists[t][s][0],newest:a.lists[t][s][a.lists[t][s].length-1],oldest_owner_new:o[0],newest_owner_new:o[o.length-1]};Object.assign(a.lists.active,r)}return a.dType=y.full,["cursor","auth","channel","owner","view","app","txn"].map(t=>L.store[t]=e.clone(a[t])),L.store.key=L.key,L.store.api=P.api,L.store.active=(a.lists?a.lists.active:n.active)||{},s.stop(),a})(t)),s.stop(),N(t)},U=t=>{var s;return t.newer.mode!==b.replay?s=0===L.cursor?M(t.cache):t.cache.meta.type<e.lTypes.newest?t.newer.data:t.newer.data.dType===e.dTypes.scroll?t.newer.data:M(t.cache):((s=Object.assign(t.newer.data,M(t.cache))).mode=b.replay,s.cursor=L.cursor),s.list&&s.active.model===e.ModelName(e.Models.Message)&&(s.msg_list||(s.msg_list={}),s.msg_list.list=[],Object.assign(s.msg_list,t.newer.data.meta),s.msg_list.list=s.list),L.logs.push(s),t},j=e=>(d.pub(c.State,L.cursor),L.status=1,e),q=e=>{{const e=`: Cache @ api='${P.api}', key='${L.key}' : messages:`;i?a("#",L.cursor,`state.logs[${L.cursor}] :`,L.logs[L.cursor]):r("#",L.cursor,"state.logs:",L.logs.length,L.logs),"synch"===P.mode?a("#",L.cursor,e,P.get()[L.key]):P.get().then(t=>{a("#",L.cursor,e,t[L.key])})}return e},B=e=>{L.status=0,(()=>e.then(t=>{if(!(t&&t.hasOwnProperty("data")&&t.hasOwnProperty("mode")))return Promise.reject({why:"Does not abide eType.Actions signature.",what:e,where:"got()"});L.key=t.data.owner&&t.data.owner.handle&&t.data.channel&&t.data.channel.slug&&t.data.owner.handle+"/"+t.data.channel.slug||L.key||"";const s={newer:t,cache:P.get(L.key)};return""===L.key?Promise.reject({why:"No key.",what:e,where:"got(ebMsg)"}):Promise.all([s.newer,s.cache]).then(e=>Promise.resolve({newer:e[0]||{},cache:e[1]||{}}))}))().then($).then(C).then(D).then(N).then(R).then(I).then(F).then(U).then(j).then(q).catch(e=>{L.status=1,"No changes."===e.why?r("#",L.cursor,L.key,e):void 0!==L.cursor?n("#",L.cursor,L.key,e):o("#",L.cursor,L.key,e)})};e.State=()=>L,e.SS=()=>P,d.sub(c.Action,e=>(_(O,T(5),B,e),"State")),r(i)}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e,t){"use strict";e.log("Auth",e.log.levels.INFO);const s=e.log("Auth",e.log.levels.ERROR),a=e.log("Auth",e.log.levels.DEBUG),n=(e.log("Auth",e.log.levels.FOCUS),e.log("Auth",e.log.levels.WARN)),o=e.log.debugOFF,r=e.EB(),i=r.eTypes(),l=e.AuthStore(),d=e.State(),{UTCtoSec:c,nowUTC:u,time2UTC:h,parseJWT:p,sha512:g,rand:m,isString:f,xor:w,rev:v,base64Encode:y,aFetch:b,aDelay:_,ttl:T,urlAOA:A,urlAPI:S,urlPWA:k}=e,P=e.cfg.auth.obfuscate,x=(e.cfg.auth.modesCSRF,e.cfg.auth.keyTknAccess),L=e.cfg.auth.keyTknRefresh,O=e.cfg.auth.keyOA,E=e.cfg.auth.keyCSRF,M="_na",$="_nb",C="_nc",D=(...t)=>e.Cookies.del(...t),N=t=>e.Cookies.get(t),R=(t,s,a)=>e.Cookies.set(t,s,1),I=e=>e.payload&&T(e.payload.exp)>0,F=e=>!!e.payload&&{type:e.payload.tokenType,exp:e.payload.exp,expUTC:h(e.payload.exp),TTL:T(e.payload.exp),header:e.header,payload:e.payload},U=e=>!!I(p(e))&&e,j=e=>{const t=p(e);return!!I(t)&&t},q=e=>{const t=p(e);return t&&t.payload&&t.payload.exp?T(t.payload.exp):0},B=e=>{const t=p(e);return!!t&&t.payload.sub},H=(e,t)=>l.set(e,t),G=e=>l.get(e),V=()=>l.del(),W=V,J=e=>G(e).then(U),z=e=>J(e).then(e=>!!e),X={user:{},sub:"",a:{exp:0,expUTC:""},r:{exp:0,expUTC:""},mode:"",provider:"",err:{a:!0,r:!0}},K=(e,t)=>t&&t.user_id!==e.sub?Promise.reject({why:"MISMATCH : as.sub VERSUS user.user_id",what:{as:e,user:t},where:"statusSet(..)"}):(e=t?Object.assign(e,{user:t}):e,l.set("status",e).then(t=>!!t&&e)),Y=e=>(void 0===e&&(e=X),e.a.ttl=`${Math.floor(T(e.a.exp)/60)} min ${T(e.a.exp)%60} sec`,e.r.ttl=`${Math.floor(T(e.r.exp)/60)} min ${T(e.r.exp)%60} sec`,e),Q=t=>{if(!t)return;const s=(t=>({user:t.user,mode:t.mode,provider:t.provider,err:t.err,a:e.parseJWT(t.a),r:e.parseJWT(t.r)}))(t),a=!!s.a&&s.a.payload,n=!!s.r&&s.r.payload,o=s.a&&s.r&&s.a.payload.sub===s.r.payload.sub||!1,r=s.a&&s.r&&o||!(s.a&&s.r),i=t=>{const s=(e=>(e?e.exp:0)&&(e.exp>0?e.exp:0)||0)(t);return{exp:s,expUTC:e.time2UTC(s)}};return X.a=i(a),X.r=i(n),X.sub=o&&s.r.payload.sub||!r&&"MISMATCH"||!1,X.user=s.user,X.mode=s.mode,X.provider=s.provider,X.err=s.err,r?!s.a||s.r&&!s.err.r?!s.r||s.a&&!s.err.a?X:Promise.reject({why:"Access token : FAIL @ aFetch or AuthStore.",what:{payload:s,authStatus:X},where:"statusMake(tkns)"}):Promise.reject({why:"Refresh token : FAIL @ aFetch or AuthStore.",what:{payload:s,authStatus:X},where:"statusMake(tkns)"}):Promise.reject({why:'SECURITY WARNING : Tokens "sub" claim MISMATCH',what:{payload:s,authStatus:X},where:"statusMake(tkns)"})},Z=()=>le.StatusGet().then(e=>(r.pub(i.Auth,e),e)),ee=e=>{const t={};return e.a&&e.r?Promise.all([H(x,e.a),H(L,e.r)]).then(s=>s.map((s,a)=>s||Object.assign(t,0==a?{a:e.a,aTxt:"Access"}:{r:e.r,rTxt:"Refresh"}))).then(t=>t.rTxt||t.aTxt?Promise.reject({why:`${t.aTxt}`+`${t.rTxt?" and "+t.rTxt:""}`+" token(s) : FAILed to store.",what:{a:t.a,r:t.r},where:"store(..)"}):(e.err={a:!!t.aTxt,r:!!t.rTxt},a("@ store : tokens stored:",e),e)).then(Q).then(e=>K(e).then(t=>t?(a("@ store : status stored:",e),Z()):Promise.reject({why:"authStatus : FAILed to store",what:e,where:"statusSet(..)"}))):Promise.reject({why:"One or both tokens are missing.",what:e,where:"store(..)"})},te=()=>{const e={method:"GET",headers:new Headers({}),credentials:"include"},t=A("/a/logout"),n=new Request(t,e);return W().then(()=>b(n).then(a).catch(s))},se=()=>te().then(()=>window.location.href=k("/app/login")),ae=()=>{return J(L).then(e=>e?(e=>le.Authorized().then(t=>{if(t)return Promise.reject({why:"Authorized already.",what:t,where:"accessRefresh()"});const s={method:"GET",headers:new Headers({Authorization:`Bearer ${e}`}),credentials:"include"},n=A("/a/refresh"),o=new Request(n,s);return b(o).then(t=>304===t.meta.status?Promise.reject({why:"Access token remains valid.",what:t,where:"refreshHandle(..)"}):401===t.meta.status?Promise.reject({why:"Authentication expired",what:t.meta,where:"refreshHandle(..)"}):423===t.meta.status?Promise.reject({why:"Access expired; Refresh valid",what:t.meta,where:"refreshHandle(..)"}):200!==t.meta.status?Promise.reject({why:"Failed fetch.",what:t.meta,where:"refreshHandle(..)"}):t.body.a?I(p(t.body.a))?(a("Access token is REFRESHed."),le.StatusGet().then(s=>{const a={a:t.body.a,r:e};return a.mode=s.mode,a.provider=s.provider,a.user=s.user,ee(a).then(()=>a.a).catch(e=>Promise.reject(e))})):(a("FAIL @ Access token refresh."),Promise.reject({why:"Access token REFRESH FAILED.",what:t,where:"refreshHandle(..)"})):Promise.reject({why:"Access token NOT received.",what:t,where:"refreshHandle(..)"}))}))(e):se())},ne=()=>J(x).then(e=>e||ae()).catch(e=>(s(e),!1)),oe=(t,s,n)=>ne().then(o=>{const l=m(15),d=new Headers({Authorization:`Bearer ${o}`,"X-CSRF-Token":l}),c=S(s),u={method:t,headers:d,credentials:n&&n.csrf?"include":"same-origin",body:n?JSON.stringify(n):void 0},h=new Request(c,u);return n&&n.csrf&&R(E,n.csrf),a({csrf:{key:E,val:n&&n.csrf},req:h}),b(h).then(e=>(n&&n.csrf&&D(E),e)).then(t=>(r.pub(i.Net,{data:{http:t.meta},mode:e.aModes.promise}),t))}),re=t=>(D(M,$,C),200!==t.meta.status&&201!==t.meta.status?Promise.reject({why:"Failed to fetch auth tokens.",what:{status:t.meta.status,statusText:t.meta.statusText,url:t.meta.url,method:t.meta.req.method},where:"tknsHandle(..)"}):t.body.a&&t.body.r?(t.body.mode=t.body.mode?t.body.mode:P?e.AuthModes.ObfuscateBA:e.AuthModes.BasicAuth,a("@ mode",t.body.mode,"| body:",t),ee(t.body)):Promise.reject({why:"One or both auth tokens missing from response.",what:{at:t.body.a,rt:t.body.r,meta:t.meta},where:"tknsHandle(..)"})),ie=(t,s)=>{P||D(M,$,C);const a=window.crypto||window.msCrypto,o=()=>(function(t,s){const a=P&&N(M),o=P&&N(C),r=f(o)&&o.length>100?o:N($),i=P&&f(a)&&a.length>100&&f(r)&&r.length>100,l=i?w(t,v(a)):t,d=i?w(s,w(a,v(r))):s,c=`${l}:${d}`,u={method:"GET",headers:new Headers({Authorization:`Basic ${y(c)}`,"X-CSRF-Token":e.rand(15)}),credentials:"include"},h=A("/a/login"),p=new Request(h,u);return i||D(M,$,C),o||n("Failed to generate client-side nonce cookie."),b(p).then(re)})(t,s);return crypto.subtle&&P?g(a.getRandomValues(new Uint32Array(1))[0]).then(e=>R(C,e)).then(o):o()},le={FetchAPI:oe,Purge:te,Login:se,Claim:e=>{const t={method:"POST",body:JSON.stringify(e),credentials:"include"},s=A("/a/signup/claim"),n=new Request(s,t);return a("claim(..) :",{url:s,payload:e}),R(E,e.csrf),b(n).then(e=>e.meta&&202===e.meta.status?e:Promise.reject(e))},Apply:(e,t)=>{const s={method:"POST",body:JSON.stringify(t),credentials:"include"},n=A(`/a/${e}/apply`),o=new Request(n,s);return a("apply(..) :",{url:n,payload:t}),R(E,t.csrf),b(o).then(e=>e.meta&&202===e.meta.status?e:Promise.reject(e))},Verify:(e,t)=>{const s={method:"POST",body:JSON.stringify(t),credentials:"include"},n=A(`/a/${e}/verify`),o=new Request(n,s);return a("verify(..) :",{url:n,payload:t}),R(E,t.csrf),b(o).then(e=>!e.meta||201!==e.meta.status&&200!==e.meta.status?Promise.reject(e):e).then(re)},Basic:(e,t)=>le.Authenticated().then(s=>!s&&ie(e,t)),CheckOAuth:()=>{const t=N(O),s=m(55),a=e=>(R(O,s),D(O,M,$,C),e);return le.StatusGet().then(s=>{if((e=>!!e.sub)(s))return a(s);if(!t)return!1;const n=e.base64Decode(t),o=JSON.parse(n);return ee(o).then(e=>e.a&&e.r?Promise.resolve(e):Promise.reject({why:`One or both tokens missing from ${O} cookie.`,what:e,where:"checkOAuth(..)"})).then(a).then(le.StatusGet)})},Authenticated:()=>z(L),Authorized:()=>z(x),AccessGet:ne,StatusGet:()=>(()=>l.get("status"))().then(Y),SubRecordGet:()=>{const e=e=>e.body?e.body:Promise.reject(e.meta);return ne().then(B).then(t=>t?oe("GET",`/u/${t}`).then(e):Promise.reject({why:"Authorization expired.",what:{sub:t},where:"SubRecordGet() : aFetchAuthAPI(..)"})).then(e=>e&&e.user_id?le.StatusGet().then(t=>K(t,e)):Promise.reject({why:"User record INVALID.",what:e,where:"SubRecordGet() : resetAuthStatus(user)"})).then(e=>r.pub(i.Auth,e)&&e.user).catch(s)},UserPSP:(t={user:{}})=>{const s=(t.user&&t.user.profile_buyin||"|||||").split("|"),a=Math.ceil((e.nowSec()-e.UTCtoSec(s[5]))/86400),n=parseInt(s[4],10);return{acctType:s[0],gid:s[1],cid:s[2],pid:s[3],lastMax:n,lastDate:s[5],lock:a<e.LockPeriod&&n,lockDaysRemain:e.LockPeriod-a>0?e.LockPeriod-a:0}},Store:e.AuthStore(),Token:{A:x,R:L,TTL:q,get:G,getValid:J,getTTL:e=>J(e).then(q),set:H,del:V,show:e=>G(e).then(j).then(F),refreshAccess:ae}};e.Auth=()=>le,r.sub(i.State,e=>0===e&&Z()),!o&&_(2,()=>{le.StatusGet().then(e=>{const t=T(e.a.exp),s=T(e.r.exp);a("Status :",e),a("Access : TTL:",Math.floor(t/60),"min",t%60,"sec",{expUTC:e.a.expUTC}),a("Refresh : TTL:",Math.floor(s/60),"min",s%60,"sec",{expUTC:e.r.expUTC})}),le.Authorized().then(e=>a("Authorized:",e)),le.Authenticated().then(e=>a("Authenticated:",e)),a("state",d)})}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e,t){e.log("Action"),e.log("Action",e.log.levels.ERROR);const s=e.log("Action",e.log.levels.DEBUG),a=(e.log("Action",e.log.levels.FOCUS),e.log.debugOFF),n=e.EB(),o=n.eTypes(),r=(e.State(),e.aModes),i=e.isObject;Object.keys(o).map(e=>{n.sub(o[e],(e=>(function(t){const a={EtypeFoo:e=>({data:{viewComponent:{renderer:e.want}},mode:r.replay}),Txn:e=>(s("Txn : ebMsg:",e),{data:{txn:e},mode:r.promise}),Auth:e=>(s("Auth : ebMsg.user:",e.user),e.user&&e.user.user_id&&(e.user.subing=e.user.subed_free.length+e.user.subed_once.length+e.user.subed_recur.length),{data:{auth:e},mode:r.promise}),Net:e=>({data:e.data,mode:e.mode}),MsgListMenu:e=>!!["Threads","Newest","Oldest"].includes(e.want)&&{data:{msgListMenu:{want:e.want}},mode:r.replay},CentreMenu:e=>!!["CentreList"].includes(e.want)&&{data:e.data,mode:r.replay}};if(!a.hasOwnProperty(e))return;const l=a[e](t);l&&l.hasOwnProperty("data")&&i(l.data)&&l.hasOwnProperty("mode")&&n.pub(o.Action,Promise.resolve(l)),s({action:e,keys:l.data?Object.keys(l.data).filter(e=>"mode"!==e&&"dType"!==e):l,mode:l.mode})}))(e))}),s(a)}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{})),function(e,t){const s=e.log("Net",e.log.levels.INFO),a=e.log("Net",e.log.levels.ERROR),n=e.log("Net",e.log.levels.DEBUG),o=(e.log("Net",e.log.levels.FOCUS),e.log.debugOFF),r=e.log.profOFF,i=e.EB(),l=i.eTypes(),{aFetch:d,aDelay:c,profile:u,time2UTC:h,aModes:p,dTypes:g,aScheduleSeq:m,seqArr:f,once:w,UTCtoMsec:v,time2ISO:y,nowISO:b}=e,{service:_,rootAPI:T,baseAPI:A,uriDefault:S,msgListFull:k,msgListDiff:P}=e.cfg.net,x=e.State().store,L={newest:0,oldest:0},O=e=>{const t=u("renorm()");return t.start(r),e.messages?(e.list=e.messages.list,e.meta=e.messages.meta,delete e.messages):e.chn_id&&(e={channel:e}),t.stop(),Promise.resolve(e)},E=e=>i.pub(l.Net,{data:e,mode:p.promise}),M=(t,o)=>{s(`@ getResource(${o}) >`,t),((t,s)=>{const o=new Headers({Accept:"application/json","Cache-Control":"no-store, max-age=0","If-Modified-Since":h(L.newest)}),r=new Request(t,{headers:o,method:"GET",mode:"cors"});return d(r).then(t=>t.meta?(t.body=t.body?t.body:{},t.body.dType=s,t.body.mode=p.promise,e.isObject(t.body)?t.body.http=t.meta:t.body={html:t.body,http:t.meta},t.meta.status<400?n("resp @ aFetch(..) : HTTP meta:",t.meta):a("resp @ aFetch(..) : HTTP meta:",t.meta),delete t.meta,Promise.resolve(t.body)):Promise.reject({why:"Network meta data is missing.",what:t,where:"aFetch(..)"}))})(t,o).then(O).then(E).catch(e=>{E({http:e,mode:p.promise}),e.status?a(e):a("Fetch API :",e)})},$=(e,t)=>{e=`${e}/${L.newest}/-${P||33}`,M(e,t)},C=w(e=>{n("@ onSchedule(diff) LAUNCH > url >",e);const t=[1,2,5].map(e=>15e3*e);m(f(t,0,!0),$,e,g.diff)}),D=e=>{window.location.href;const t=window.location.origin,a=(window.location.protocol,window.location.host,window.location.pathname,window.location.pathname.substring(1)),n=e.uri?`${T}${A}/${e.uri.join("/")}`:a?`${t}/${a}`:`${t}${S}`;return s("@ setURL",{ebMsg:e,url:n}),n},N=["init","older","newer","update","channel","top"],R=e=>{if(!e.want)return void a("BAD ebMsg SIGNATURE : ebMsg.want is MISSING");const t={};return N.map(s=>t[s]=e.want.includes(s)),Object.values(t).filter(e=>!0===e).length?(t.init&&M(D(e),g.full),t.older&&(e.dType===g.full?M(D(e),g.full):e.dType===g.scroll?M(D(e),g.scroll):M(D(e),g.diff)),t.newer&&M(D(e),e.dType),t.newer&&C(D({uri:[e.uri[0],e.uri[1],e.uri[2]]})),t.update&&M(D(e),e.dType),t.channel&&M(D(e),e.dType),t.top&&M(D(e),e.dType),s("@ onDemand(ebMsg)",{wants:[Object.keys(t).filter(e=>t[e]&&e)].join(" "),dType:e.dType,uri:e.uri?`/${e.uri.join("/")}`:e.uri}),"Net"):void 0};A||a("Missing API config."),n(o),i.sub(l.Loader,R),i.sub(l.View,R),i.sub(l.State,()=>x.active&&x.active.newest&&(L.newest=x.active.newest.date||0,L.oldest=x.active.oldest.date||0))}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";(window[__APP__]=window[__APP__]||{}).filltext=e=>{var t,s="";t=["Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.","Maecenas luctus libero id justo. Curabitur nibh pede, dignissim pharetra, ullamcorper nec, scelerisque in, justo.","Donec autem vel ac dolor venenatis. In hac habitasse platea dictumst. Pellentesque tortor iusto, vulputate diam.","Aliquam nisi et augue consectetuer, lacus ut cursus ornare, elit mauris pellentesque quam, vitae luctus erat nunc vel massa."];for(var a=0;a<e;a++)s+=t[Math.floor(4*Math.random())]+" ";return s}}(),function(e,t){"use strict";const s=e.create("GHOST"),a=e.css("header .site");if(!a)return;e.log("header"),e.log("header",e.log.levels.ERROR),e.log("header",e.log.levels.FOCUS);const n=e.EB(),o=n.eTypes(),r=e.cfg.view.header,{throttle:i,id:l,tags:d,css:c,cssAll:u}=e,h=parseInt(r.logoResizeTrigger,10),p=e.css("#channel-header .menu"),g=c("#channel-header .menu UL"),m=g?{one:c('LI A[href="#1"]',g),two:c('LI A[href="#2"]',g),three:c('LI A[href="#3"]',g)}:null,f=c(".site .menu BUTTON",a)||s,w=c(".logo svg",a)||s,v=c("svg.menu-open",a)||s,y=c("svg.menu-close",a)||s,b=c(".menu UL",a)||s,_=c(".nav UL",a)||s,T=(u("LI",b),u("LI",_),c('.menu LI A[href="/app/logout"]',a),l("overlay-1")||s),A=c("#channel")||s,S=(A&&A.dataset.slug,`(max-width: ${r.maxWidth})`),k=(window.matchMedia(S),"active"),P="block",x={size:"",activeMenu:d("A",b)[0],activeNav:d("A",_)[0]},L=()=>{b.style.display=P,v.style.display="none",y.style.display=P,y.classList.add("rotate"),T.style.display=P,A.classList.add("blur")},O=()=>{b.style.display="none",v.style.display=P,y.style.display="none",T.style.display="none",A.classList.remove("blur")},E=(e,t)=>{[...d("A",t)].map(e=>e.classList.remove(k)),e.classList.add(k)};(e=>{const t=location.hash[1]||location.pathname.replace(/^.*[\\\/]/,""),s=`A[href="/app/${A.dataset.slug}"]`;x.activeMenu=c(s,b)||d("A",b)[0],x.activeNav=c(s,_)||d("A",_)[0],[...d("A",e)].filter((s,a)=>{s.href.replace(/^.*[\\\/]/,"")===t&&(x.activeMenu=d("A",e)[a]),s.hash[1]===t&&(x.activeMenu=d("A",e)[a])})})(b),x.activeMenu.classList.add(k),x.activeNav.classList.add(k),p||w.classList.add("small"),n.sub(o.State,t=>{const s=e.State().store;if(s.owner&&s.channel&&m)switch(!0){case"pub"===s.channel.slug||"sub"===s.channel.slug:m.one.href=`/${s.owner.handle}/pub`,m.two.href=`/${s.owner.handle}/sub`,"pub"===s.channel.slug?m.one.classList.add(k):m.two.classList.add(k);break;case"app"!==s.owner.handle&&"pub"!==s.channel.slug&&"sub"!==s.channel.slug:g.classList.add("hide")}}),v.addEventListener("click",L),y.addEventListener("click",O),T.addEventListener("click",O),b.addEventListener("click",e=>{e.target&&"A"===e.target.nodeName&&E(e.target,b)}),b.addEventListener("keydown",e=>{"Escape"===e.key&&y.style.display===P&&O()}),f.addEventListener("keydown",e=>{"Enter"===e.key&&(v.style.display===P?L():O())}),_.addEventListener("click",e=>{e.target&&"A"===e.target.nodeName&&E(e.target,_)}),g&&g.addEventListener("click",e=>{e.target&&"A"===e.target.nodeName&&E(e.target,g)}),window.addEventListener("scroll",i(40,e=>{const t=window.scrollY;t>250&&"small"===x.size||(x.size||(x.size="big"),"small"===x.size&&t<h&&(p&&w.classList.remove("small"),x.size="big"),"big"===x.size&&t>=h&&(w.classList.add("small"),x.size="small"))}))}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.css("#msg-list"),a=e.css("#msg-list-menu");if(!s||!a)return;const n="thread-toggler",o=e.cfg.view.msgs,r=e.EB(),i=r.eTypes(),l=(e.dTypes,e.log(n),e.log(n,e.log.levels.FOCUS),e.log(n,e.log.levels.ERROR)),d=e.css,c=e.cssAll,u=e.create,h=e.setText,p=e.aDelay,g=e.throttle,m="expand",f=e=>`${o.svgsPath}#def-${e}`,w=f("collapse"),v=f(m),y=u("GHOST"),b=e.debounce(200,()=>r.pub(i.View,{want:[],arg:"toggleThreadFired",args:[],uri:[]})),_=e.Page(),T=(e,t)=>{const s=c(`#${e.id}>.thread`,e),a=c(`#${e.id} .thread`,e),n=d(".toggle .title svg use",e),o=d(".toggle .count-replies",e),r={flag:void 0,href:void 0};if(!n)return l("@ toggleThread(..) : falsey button : implies DUPLICATE IDs rendered:",{thread:e,action:t});_.embedded&&b(),"collapse"===t&&(r.flag="true",r.href=v,n.parentNode.parentNode.dataset.title="Expand",o.textContent=`${s.length}/${a.length}`),t===m&&(r.flag="",r.href=w,n.parentNode.parentNode.dataset.title="Collapse",o.textContent=""),[...s].map(e=>{e.dataset.selfCollapsed=r.flag}),n.setAttribute("href",r.href),e.dataset.threadCollapsed=r.flag},A=e=>{const t=(e=>{const t={eTarget:void 0,thread:void 0};return e.matches(".toggle .title")&&(t.eTarget=e.parentNode),e.matches(".toggle .title svg")&&(t.eTarget=e.parentNode.parentNode),e.matches(".toggle .title svg use")&&(t.eTarget=e.parentNode.parentNode.parentNode),t.eTarget&&(t.thread=d(`#${t.eTarget.dataset.msgRef}`)),t.thread&&t.thread.classList.remove("new"),t.thread})(e.target);t&&(t.dataset.threadCollapsed?T(t,m):T(t,"collapse"))},S=d("li.toggle",a)||y,k=d("em",S),P=d("svg",S),x=d("use",P),L=e=>{"true"!==S.dataset.disable&&[...c(".thread",s)||[]].map(t=>{"true"===t.dataset.threadReplies&&T(t,e)})},O=e=>h(k,"collapse"===e?"Expand":"Collapse"),E=e=>{"collapse"===e&&(L("collapse"),x.setAttribute("href",v),O("collapse")),e===m&&(L(m),x.setAttribute("href",w),O(m))},M=e=>{if("true"===S.dataset.disable)return;const t="mouseenter"===e.type,s="mouseleave"===e.type;t&&P.classList.add("hover"),s&&P.classList.remove("hover"),t||s||(x.getAttribute("href")===w?E("collapse"):E(m))},$=e=>{const t=e.want.includes("init"),a=e.want.includes("reset"),r=e.want.includes("collapseThread");return s&&(a||t)?(s.removeEventListener("click",A),t&&(o.collapseAll?L("collapse"):L(m)),r&&T(e.node,"collapse"),s.addEventListener("click",A),p(1e4,()=>[...c(".thread",s)].map(e=>e.classList.remove("new"))),n):n};S.addEventListener("mouseenter",M),S.addEventListener("mouseleave",M),S.addEventListener("click",g(500,M)),r.sub(i.Loader,$),r.sub(i.View,$),r.sub(i.Action,e=>{e.then(e=>{return e&&e.data&&e.data.msgListMenu&&(o.collapseAll?E("collapse"):E(m)),n}).catch(l)})}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.css("#msg-list");if(!s)return;const a=e.cfg.view.msgs,n=e.EB(),o=n.eTypes(),r="form-msg",i=(e.log(r),e.log(r,e.log.levels.DEBUG)),l=(e.log(r,e.log.levels.FOCUS),e.log(r,e.log.levels.ERROR)),d=e.css,c=e.cssAll,u=e.create,h=window.location.pathname,p=`${a.svgsPath}#def-reply-open`,g=`${a.svgsPath}#def-reply-close`,m=`${a.svgsPath}#def-reply-close`,f=u("GHOST"),w=d("#form-msg-new"),v=d("#form-msg-new BUTTON")||f,y=()=>d("#form-msg"),b=`\n             <div id="form-msg" class="form-msg">\n                <form method="post" action=""> \n                    <fieldset name=inner class="">\n\n                        <label for="title" class="">Title</label>\n                        <textarea type="text" \n                            required\n                            autocomplete=off\n                            minlength=1\n                            maxlength=128\n                            name="title"\n                            placeholder=""></textarea>\n \n                        <label for="body" class="">Message</label>\n                        <textarea type="text" \n                            required\n                            autocomplete=off\n                            minlength=1\n                            maxlength=${a.maxShort}\n                            name="body"\n                            placeholder="&hellip;"></textarea>\n\n                        <button type="submit">Publish</button>\n\n                    </fieldset>\n                </form>\n            </div>\n            `,_=e=>window.top.location.href=e,T={},A=t=>{const s=e.Auth(),a=e.State().store,r=!!a.owner&&a.owner.user_id===a.auth.sub,c=!!a.channel&&a.channel.msg_form===e.mForm.long,u=!!a.view&&"thread-view"===a.view.vname,h=!(t===v),p=d("FORM",y()),g=d("BUTTON",p),m=d('LABEL[for="body"]',p),f=d('LABEL[for="title"]',p),w=d('TEXTAREA[name="body"]',p),b=d('TEXTAREA[name="title"]',p),A=t.closest("div.thread"),k=A&&A.dataset.chnId||a.channel.chn_id,P=A?A.id.replace("m-",""):void 0,x={form:e.mForm.short,chn_id:k,to_id:P,to_display:P?A.dataset.authorDisplay:void 0,to_handle:P?A.dataset.authorHandle:void 0,author_id:a.auth.sub,author_display:a.auth.user.display,author_handle:a.auth.user.handle,author_avatar:a.auth.user.avatar||e.cfg.view.avatarDefault,author_badges:a.auth.user.badges,csrf:e.rand(22)},L={invalid:!0},O=c&&r&&!u&&!h?[w,b]:[w],E=()=>(O.map(e=>e.checkValidity()?e.classList.remove("invalid"):(e.classList.add("invalid"),L.invalid=!0)),L.invalid?(g.classList.add("disabled"),g.disabled=!0):(g.classList.remove("disabled"),g.disabled=!1));if(c&&r&&!u&&!h?b&&b.focus():([b,f].map(e=>e.classList.add("hide")),w&&w.focus()),!T.svg&&(T.svg=t,T.use=t.firstElementChild),!a.auth||!e.ttl(a.auth.r.exp))return[m,w,f,b].map(e=>e.classList.add("hide")),e.setText(g,"Login required"),void(g&&g.addEventListener("click",e=>{e.preventDefault(),_("/app/login")}));a.auth&&a.auth.user&&a.auth.user.handle?(L.invalid=!0,E(),p&&p.addEventListener("keyup",e.throttle(100,e=>{L.invalid=!1,E()})),g&&g.addEventListener("click",r=>{r.preventDefault();const d=t=>{switch(e.lTypes[a.active.type]){case e.lTypes.chn:return a.channel.chn_id;case e.lTypes.pub:case e.lTypes.sub:return a.channel.owner_id;case e.lTypes.th:return t.body.msg_id}};x.title=b.value,x.body=w.value,x.form=a.channel.msg_form,a.owner.user_id!==a.auth.sub&&(x.form=e.mForm.short),x.to_id&&(x.form=e.mForm.short),i("@ doMsgSubmit : msg:",x),s.FetchAPI("POST","/m",x).then(s=>(S({target:t}),i("@ postHandler : resp:",s),s.meta&&s.meta.status>399?Promise.reject({body:s.body,meta:s.meta}):(n.pub(o.View,{dType:e.dTypes.diff,want:["newer"],uri:["ml",a.active.type,d(s)]}),s))).then(i).catch(l)})):(t=>{const a=e.ancestor(t,"div.thread"),n=a?`#${a.id}`:"";s.SubRecordGet().then(()=>_(window.location.href+n))})(t)},S=t=>{const s=t.target,a={form:y(),useReply:c("#msg-list svg.reply use")||[],active:void 0,button:void 0,container:void 0};n.pub(o.View,{node:a.form,dType:null,want:[],arg:"toggleFormRequest",args:[],uri:[]}),(s&&s.matches("svg.reply")||s&&s.matches("svg.new"))&&(a.button=s,a.active=a.button.querySelector("use")),(s&&s.matches("svg.reply use")||s&&s.matches("svg.new use"))&&(a.active=s,a.button=a.active.parentNode),a.button&&(a.container=e.ancestor(a.button,"div.options")),s&&s===v&&(a.button=s,a.container=d("#form-msg-new form"));const r=e.State().store;r.auth&&r.auth.user&&0===r.auth.user.tokens_q?a.button&&(a.button.disabled=!0):a.form?a.button&&(a.form.remove(),[...a.useReply].map(e=>e.parentNode.classList.contains("active")&&(e.setAttribute("href",p),e.parentNode.classList.remove("active"))),v&&(v.innerHTML="New Message")):(a.button&&(a.container.insertAdjacentHTML("afterend",b),a.form=y(),a.form.querySelector("textarea").focus(),A(s)),a.button!==v?a.active&&(a.active.setAttribute("href",g),a.button.classList.add("active")):v&&(v.innerHTML=`\n                            <svg class="new"><use href="${m}"></use></svg>`))},k=e=>{if("toggleFormRequest"===e.arg||e.want.includes("init"))return v&&v.removeEventListener("click",S),s&&s.removeEventListener("click",S),v&&(v.innerHTML="New Message",v.addEventListener("click",S)),s&&s.addEventListener("click",S),r};i(""),n.sub(o.Loader,k),n.sub(o.View,k),"/sub"===h.substring(h.length-4)&&(w.style.display="none")}(window[__APP__]=window[__APP__]||{}),function(e,t){e.log("View"),e.logWarn("View"),e.logErr("View");const s=e.logDeb("View"),a=(e.logFocus("View"),e.log.profOFF),n=e.profile("View"),o=e.EB(),r=o.eTypes(),i=e.State(),l={},d={log:t=>e.log(`View/${t}`),logDeb:t=>e.logDeb(`View/${t}`),logErr:t=>e.logErr(`View/${t}`),logFocus:t=>e.logFocus(`View/${t}`),msglistHeader:e.css("#channel main h4")||e.create("GHOST"),msglistNode:e.css("#msg-list"),components:l,validate:{node:(e,t)=>!!e||(s(`'${t}' : HTML node NOT EXIST.`),!1),key:(e,t)=>!!e.hasOwnProperty(t)&&void 0!==e[t]},gc:(t,...s)=>!!e.aDelay(2e3,()=>Object.keys(t).map(e=>s.includes(e)||delete t[e]),t,...s),banner:t=>t?`${e.cfg.view.banners}/${t}`:`${e.cfg.view.banners}/ghost-1778x500.png`,avatar:t=>t?`${e.cfg.view.avatars}/${t}`:`${e.cfg.view.avatars}/user-x-00.png`,avatarMBF:(t="A")=>`${e.cfg.view.avatars}/unicode/mbf/cap-${t.substring(0,1).toLowerCase()}.svg`,avatarMBFRand:()=>`/sa/media/avatars/unicode/mbf/cap-${String.fromCharCode(65+e.randInt(25))}.svg`,avatarMBFStr:(e="A")=>`\n                <svg \n                    viewBox="0 -15.5 13 20" xmlns="http://www.w3.org/2000/svg">\n                    <defs>\n                        <style>\n                            @font-face {\n                                font-family: 'symbola-mbf';\n                                font-weight: normal;\n                                font-style: normal;\n                                src: url('symbola-mbf.woff') format('woff');\n                            }\n                            .sbmf {\n                                font-family: symbola-mbf;\n                                fill: #333;\n                            }\n                        </style> \n                    </defs>\n                    <text class="smbf">${e.substring(0,1).toUpperCase()}</text>\n                </svg>\n            `,minMsgQ4P:e.cfg.view.msgs.minQ4P,dtThrottle:1e3,headerSite:e.css("header>section.site"),unitHeight:this.headerSite&&Math.round(2.1*this.headerSite.scrollHeight)||150,cfgMsgs:e.cfg.view.msgs,dtReplayRender:10};l.foo=(()=>{const t=e.css("#foo");if(!d.validate.node(t,"#foo"))return function(){};e.Auth(),e.EB().eTypes(),e.State(),d.components,d.logDeb("foo"),e.log.debugOFF,d.logErr("foo"),d.logFocus("foo");return e=>{if(!d.validate.key(e,"foo"))return!1}})(),e.View=()=>d,o.sub(r.State,e=>{const t=isNaN(e)?i.get():i.get(e);Object.keys(d.components).map(e=>d.components[e](t)),s("#",i.cursor,"@ render > mode:",t.mode)}),n.start(a),s("")}(window[__APP__]=window[__APP__]||{}),function(e,t){const s=e.css("#http"),a=e.View(),n=e.State(),o=(e.Auth(),e.EB().eTypes(),a.components),r=(a.log("http"),a.logDeb("http")),i=e.log.debugOFF;a.logErr("http"),a.logFocus("http");r(i),o.http=(()=>{if(!a.validate.node(s,"#http"))return function(){};const t={http:{},last:"",cursor:0,length:0,ids:[]},o=(t,a)=>{0!==a&&(200===t.http.status&&0!==t.cursor&&t.length?s.textContent=`Messages: ${t.length}`:s.textContent=`${t.http.statusText} (${t.http.status})`,s.classList.add("transient"),199<t.http.status&&t.http.status<305?s.dataset.net="":t.http.status<200?s.dataset.net="info":s.dataset.net="fail",t.ids.push(e.aDelay(e.cfg.view.timeTransientFX,()=>{s.classList.remove("transient"),s.textContent="",s.dataset.net=""})))};return l=>{if(!a.validate.key(l,"http"))return!1;l.http&&l.http.status&&(t.http=l.http,t.cursor=n.cursor,t.length=l.msg_list&&l.msg_list.list.length||0,(t.last!==t.http.status||200===t.http.status)&&(t.ids.map(e=>clearTimeout(e)),t.ids.length=0,s.classList.remove("transient"),e.aDelay(222,o,t,l.mode)),t.last=t.http.status,r({code:l.http.status,text:l.http.statusText,url:l.http.req?l.http.req.url:"???"}),!i||200!==t.http.status||a.gc(l.http))}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){const s="channel",a=e.css("#channel"),n=e.View();n.components[s]=(()=>{if(!n.validate.node(a,"#channel"))return function(){};const t=e.EB(),o=t.eTypes(),r=(n.logDeb(s),n.logErr(s),n.logFocus(s),e.create("GHOST")),i=e.css("#channel-header SECTION.menu"),l=e.css("#owner"),d=e.css("#owner .upper .about"),c=e.css("#owner .channel .buttons"),u=(l&&e.cssAll(".sponsor>div",l),l?e.css('.sponsor span[data-title="qToken',l):r),h=l?e.css(".about .stats table[data-followers] td",l):r,p=e.css("#form-msg-new"),g=()=>{const t=window.location.hash&&isNaN(+window.location.hash.substring(1))&&e.css(`${window.location.hash}`),s=t?t.getBoundingClientRect().top:0;t&&(window.scrollTo({top:window.pageYOffset+s-60,left:0,behavior:"smooth"}),e.aDelay(1e3,()=>window.removeEventListener("scroll",g)))};return a=>{if(!n.validate.key(a,s))return!1;"sub"===a.channel.slug?(d.classList.add("hide"),c.classList.add("hide")):(a.channel.tokens_q&&e.setText(u,a.channel.tokens_q.toLocaleString("en-US")),sc=+a.channel.subers_free+ +a.channel.subers_paid,e.setText(h,sc.toLocaleString("en-US"))),p&&t.sub(o.Auth,(t=>s=>s.sub===t?p&&!e.css("#article")&&p.classList.remove("hide"):i&&i.classList.add("hide"))(a.channel.owner_id)),a.list&&e.aDelay(1e3,g),a.list&&window.addEventListener("scroll",g)}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){const s=e.css("#owner"),a=e.View(),n=e.EB(),o=n.eTypes(),r=a.components;a.logDeb("owner"),a.logErr("owner"),a.logFocus("owner");r.owner=(()=>{if(!a.validate.node(s,"#owner"))return function(){};const t=e.create("GHOST"),r=e.css(".badges",s)||t,i=e.css("#channel").dataset.channelId||"",l=(e.id("#owner"),e.css("#owner .upper img.avatar")||t),d=e.css("#owner .upper img.banner")||t,c={invalid:!0,virgin:!0};return n.sub(o.Auth,s=>{const a=[];s.user&&(e.arrsConcat(a,s.user.subed_paid),e.arrsConcat(a,s.user.subed_free));const n=e.css("#owner .upper .channel .buttons .follow span[data-title]")||t,o=a.filter(e=>e===i).length?"Unfollow":"Follow";n.dataset.title=o,n.textContent=o}),t=>!!a.validate.key(t,"owner")&&(c.update!==t.owner.date_update&&(l.src=t.owner.avatar?a.avatar(t.owner.avatar):a.avatarMBF(t.owner.handle),d.src=a.banner(t.owner.banner),r&&t.owner.badges?e.toDOM(r,e.makeBadgeNodes(t.owner.badges).join(" ")):r.classList.add("hide"),c.update=t.owner.date_update,!0))})()}(window[__APP__]=window[__APP__]||{}),function(e,t){if(e.css("#centre"))return;const s="msgListMenu",a=e.css("#msg-list-menu"),n=e.View(),o=(e.Auth(),e.EB()),r=o.eTypes(),i=n.components;n.logDeb(s),n.logErr(s),n.logFocus(s),e.State().store;i[s]=(()=>{if(!n.validate.node(a,"#msg-list-menu"))return function(){};const t=e.css("#msg-list-menu"),i=e.cssAll("li",t),l=i[0],d=i[1],c=i[2],u=t=>{l.dataset.disable="true",d.dataset.disable="true",e.aDelay(300+n.dtReplayRender*(()=>e.cssAll("#msg-list div.msg").length||3)(),()=>{l.textContent=t,l.dataset.disable="",d.dataset.disable=""})},h=new Event("click",{bubbles:!0,cancelable:!1}),p=e=>{"Threads"===n.cfgMsgs.menuActive?d.dispatchEvent(h):l.dispatchEvent(h),o.off(r.View,p)};return t&&t.addEventListener("click",e.throttle(n.dtThrottle,e=>{"Chron"===e.target.textContent&&(e.target.textContent="Oldest");const s=e.target.textContent;"true"!==i[0].dataset.disable&&((e=>{"LI"===e.nodeName&&([...i].map(e=>e.classList.remove("active")),e.classList.add("active"))})(e.target),s&&o.pub(r.MsgListMenu,{want:s}),"Newest"===s&&u("Oldest"),"Oldest"===s&&u("Newest"),("Oldest"===s||"Newest"===s)&&(c.dataset.disable="true",d.dataset.count="",t.dataset.state=s),"Threads"===s&&(l.textContent="Chron",c.dataset.disable="",t.dataset.state=s))})),p(),e=>{if(!n.validate.key(e,s))return!1}})()}(window[__APP__]=window[__APP__]||{}),window[__APP__]=window[__APP__]||{},function(e,t){const s=e.css("#view header section.action"),a=e.View(),n=e.Auth(),o=(e.EB().eTypes(),a.components);a.logDeb("auth"),a.logErr("auth"),a.logFocus("auth");o.auth=(()=>{if(!a.validate.node(s,"#view header section.action"))return function(){};const t=s,o=e.css('#view HEADER SECTION.menu UL LI A[href="/app/logout"]'),r=e.css('#view HEADER SECTION.nav UL LI A[href="#home"]'),i=e.css("#view HEADER SECTION.menu UL"),l=e.css('#view HEADER SECTION.menu UL LI A[href="/app/start"]'),d=i&&"none"!==i.style.display,c=t=>{t.preventDefault();const s=t.target.pathname;"/app/logout"===s&&n.Purge().then(()=>e.aDelay(100,()=>window.location.href="/app/centre")),("/app/login"===s||"/app/signup"===s)&&n.Purge().then(()=>e.aDelay(100,()=>window.location.href=s))};return t&&t.addEventListener("click",e.throttle(555,c)),o&&o.addEventListener("click",e.throttle(555,c)),s=>{if(!a.validate.key(s,"auth"))return!1;if(!s.auth.a||!s.auth.r)return!1;if(!s.auth.user)return!1;const i=!!e.ttl(s.auth.r.exp),c=!!e.ttl(s.auth.a.exp);i||c?(e.purge(t),d&&e.toDOM(t,'<span><a href="/app/logout">Logout</a>'),r.classList.remove("hide"),r.href=`/${s.auth.user.handle}/pub`,l.classList.add("hide")):(e.purge(t),(e=>o.style.display=e?"block":"none")(!1),e.toDOM(t,'<span><a href="/app/login">Login</a>|<a href="/app/signup">Signup</a></span>')),i||n.Purge()}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.css("#app"),a=s&&e.css("#install"),n=s&&e.css("#account"),o=s&&e.css("#exchange"),r=s&&e.css("#profile"),i=s&&e.css("#channel-header .menu");if(!(a||n||o||r||i))return;e.cfg.view,e.log("chns");const l=e.log("chns",e.log.levels.DEBUG),d=(e.log("chns",e.log.levels.FOCUS),e.log("chns",e.log.levels.ERROR)),c=e.Auth(),u=e.EB(),h=u.eTypes(),p=e.State().store,g=e.create("GHOST"),m=e.css("SECTION.wrapper"),f=e.css("#account H1"),w=(i&&(e.css('LI A[href="#1"]',i),e.css('LI A[href="#2"]',i),e.css('LI A[href="#3"]',i)),e.cssAll("#app .content>*")),v=w?[...w].map(e=>e.id):[],y=o&&e.css("#add-p dt a"),b=o?{addQ:{dt:e.css("#add-q dt"),dd:e.cssAll("#add-q dd"),a:e.css("#add-q dt a")},redeemP:{dt:e.css("#redeem-p dt"),dd:e.cssAll("#redeem-p dd")},sponsor:{dt:e.css("#sponsor dt"),dd:e.cssAll("#sponsor dd"),a:e.css("#sponsor dt a")},subscribe:{dt:e.css("#subscribe dt"),dd:e.cssAll("#subscribe dd")}}:{},_=(o&&e.cssAll("DL",o),o?{addq:e.css("#add-q"),sponsor:e.css("#sponsor"),subscribe:e.css("#subscribe"),inform:e.css("#inform")}:{install:a}),T=e.css("#add-q form"),A=T&&e.css('input[name="amount',T),S=T?e.css("button",T):g,k=e=>A&&A.checkValidity()?(A.classList.remove("invalid"),S.disabled=!1,!0):(A.classList.add("invalid"),S.disabled=!0,!1),P=(e.css("#form-container"),e.css("#profile-buyin dt"),e.css("#profile-payout dt"),e.css(".profile-info",r),e.css("#profile-buyin dt a h2"),e.css("#settings")),x=P?e.css('H2 a[href="#edit"]',P):g,L=P?e.css('H2 a[href="#save"]',P):g,O=P?e.css('H2 a[href="#cancel"]',P):g,E={},M=n?{handle:e.cssAll("#handle td")[1]||g,display:e.cssAll("#display td")[1]||g,about:e.cssAll("#about td")[1]||g,email:e.cssAll("#email td")[1]||g}:{},$=n?{tokens_p:e.cssAll("#token-p td")[1]||g,tokens_q:e.cssAll("#token-q td")[1]||g,qrate:e.cssAll("#qrate td")[1]||g,profile_buyin:e.cssAll("#buyin td")[0]||g,profile_payout:e.cssAll("#payout td")[0]||g,subing:e.css("#subscriptions h2 .count")||g}:{},C=e.css("#subscriptions table"),D=e.css("#channels table"),N={as:{},subs:[],idem:!1},R=(t,s)=>{if(M[t]){if(!s){const s=e.css("input",M[t]);return M[t].innerHTML=s?s.value:"--",s?s.value:"--"}M[t].innerHTML=`\n                    <input type="text" \n                        name="${t}" \n                        value="${s.trim()}"\n                        required\n                        pattern=[A-Za-z0-9]{3,256}>\n                `}},I=e=>{N.as&&N.as.user&&("#save"===e.target.href.substring(e.target.href.length-5)&&(Object.keys(M).map(e=>E[e]=R(e).trim()),F(N.as)),[x,L,O].map(e=>e.classList.toggle("hide")),x.classList.contains("hide")?Object.keys(M).map(e=>R(e,N.as.user[e]||" ")):Object.keys(M).map(e=>M[e].innerHTML=N.as.user[e]))},F=t=>{const s=`/u/${t.sub}`,a={csrf:e.rand(22)};var n=!1;Object.keys(E).map(e=>E[e]!==t.user[e]&&(a[e]=E[e],n=!0)),n&&(l("@putChanges(..)","payload",a),c.FetchAPI("PUT",s,a).then(e=>204===e.meta.status?e:Promise.reject(e)).then(l).then(()=>e.Auth().SubRecordGet()).then(e=>Object.keys(M).map(t=>M[t].innerHTML=e[t])).catch(d))},U=t=>{if((!t.target.innerText||!t.target.innerText.includes("WordPress Plugin"))&&(t.target.hash||window.location.hash)&&"Account"!==e.getText(t.target)&&"Requires Login"!==t.target.innerText&&(t.preventDefault(),("A"===t.target.nodeName||"#document"===t.target.nodeName)&&(t.target.hash||window.location.hash))){const s=t.target.hash&&e.css(`${t.target.hash}`)||window.location.hash&&e.css(`${window.location.hash}`),a=s?s.getBoundingClientRect().top:0;window.scrollTo({top:window.pageYOffset+a-(20+m.clientHeight),left:0,behavior:"smooth"})}};l(""),i&&(s.style.marginTop="1em"),i&&i.addEventListener("click",t=>{v.filter((s,a)=>t.target.hash===`#${a+1}`?e.css(`#${s}`).classList.remove("hide"):e.css(`#${s}`).classList.add("hide"))}),(n||o)&&u.sub(h.Auth,e.throttle(3e3,t=>{N.as=t,l("@ doPerAuthStatus(as) : as:",t),e.ttl(t.r.exp)&&t.user?(e.setText(f,`/${t.user.handle}`),Object.keys(M).map(s=>e.setText(M[s],t.user[s])),Object.keys($).map(s=>e.setText($[s],t.user[s].toLocaleString("en-US"))),t.user&&$.subing&&e.setText($.subing,(t.user.subed_recur.length+t.user.subed_once.length).toLocaleString("en-US")),(t=>{const s=t.sub?`/cl/paid/${t.sub}`:"";l("@ getSubscriptions(as) : as:",t),s?c.FetchAPI("GET",s).then(t=>{l("@ getSubscriptions(as) : respHandler(resp) : resp:",t);const s=e.cssAll("tr",C);N.subs=t.body?t.body:[],[...s].map((e,t)=>t>0&&e.remove()),N.subs&&N.subs.list&&N.subs.list.length&&(N.subs=N.subs.list,N.subs.map(t=>e.toDOM(C,`\n                        <tr>\n                            <td class="text-left"><a href="${t.uri_local}">${t.uri_local}</a></td>\n                            <td>${t.payment}</td>\n                            <td>${t.interval?t.interval:"once"}</td>\n                            <td>${Math.round((e.UTCtoSec(t.date_expiry)-e.nowSec())/86400)}</td>\n                            ${t.interval?`<td><a href="#${t.id}" class="button">✕</a></td>`:"<td>&nbsp;</td>"}\n                        </tr>\n                    `)))}).catch(d):d("@ getSubscriptions(as)")})(t),(t=>{const s=t.sub?`/cl/owned/${t.sub}`:"";l("@ getOwnedChns(as) : as:",t),s?c.FetchAPI("GET",s).then(s=>{l("@ getOwnedChns(as) : respHandler(resp) : resp:",s),[...e.cssAll("tr",D)].map((e,t)=>t>0&&e.remove()),s.body&&s.body.list&&s.body.list.length&&s.body.list.map(s=>e.toDOM(D,`\n                            <tr>\n                                <td class="text-left">\n                                    <a href="/${t.user.handle}/${s.slug}">${t.user.handle}/${s.slug}</a>\n                                </td>\n                                <td>${s.sub_rate}</td>\n                                <td><a href="/app/channel/#${s.chn_id}" class="button">Edit</a></td>\n                            </tr>\n                        `))}).catch(d):d("@ getOwnedChns(as)")})(t),P&&[x,L,O].map(e=>e&&e.addEventListener("click",I)),y&&(t.user.profile_buyin?y.href="/app/c4":y.href="/app/c3")):x&&x.classList.add("warn")})),C&&C.addEventListener("click",t=>{if("A"!==t.target.nodeName)return;if(!t.target.hash.substring(1))return;const s=t.target.hash.substring(1),a=N.subs.filter(e=>s===e.id)[0].payee_id,n=a?{act:e.TxnAct.Subscribe,xid:t.target.hash.substring(1),xis:e.TxnXIS.Channel,payer_id:p.auth.sub,payee_id:a,tokens_q:-2,tokens_p:0,csrf:e.rand(22)}:null;n&&c.FetchAPI("POST","/x",n).then(t=>{201===t.meta.status?e.Auth().SubRecordGet().catch(d):d("FAIL @ doUnsubscribe(as) : respHandler(resp) : resp:",t)}).catch(d)}),Object.keys(b).map(e=>b[e].dt&&b[e].dt.addEventListener("click",(e=>t=>{e[0].classList.toggle("hide"),e[1].classList.toggle("hide"),p.auth&&p.auth.sub||"q"===e[1].dataset.def&&(e[1].innerHTML='\n                    <h1 class="center">\n                        <a href="/app/login" class="button">\n                            Requires Login\n                        </a>\n                    </h1>&nbsp;</h1>\n                ')})(b[e].dd))),(o&&!r||a)&&(self.addEventListener("load",U),Object.values(_).map(e=>e.addEventListener("click",U))),A&&A.addEventListener("keyup",k),A&&k(),T&&S.addEventListener("click",()=>{if(N.idem)return;N.idem=!0,S.disabled=!0;const t={act:e.TxnAct.P2q,xid:p.auth.sub,xis:e.TxnXIS.User,payer_id:p.auth.sub,payee_id:p.channel.owner_id,tokens_q:0,tokens_p:parseInt(A.value,10)||0,csrf:e.rand(22)};c.FetchAPI("POST","/x",t).then(t=>{t.body.error&&(b.addQ.dd[1].innerHTML=`<h1>FAIL : ${t.body.error}</h1>`),201===t.meta.status&&e.Auth().SubRecordGet().then(()=>b.addQ.dd[1].innerHTML='<h1>SUCCESS : <a href="/app/account">Account</a> updated</h1>').catch(d)}).catch(d)})}(window[__APP__]=window[__APP__]||{}),function(e,t){const s="msg_list",a=e.css("#msg-list");if(!a)return;e.Auth();const n=e.View(),o=e.EB(),r=o.eTypes(),i=n.components,l=n.log(s),d=n.logDeb(s),c=n.logErr(s),u=(n.logFocus(s),e.profile("View/msgList")),h=e.log.debugOFF,p=e.log.profOFF,g=window!==window.top;u.start(p),d(h),i[s]=(()=>{if(!n.validate.node(a,"#msg-list"))return function(){};const i=e.State().store,p=e.css("#centre"),m=e.css("#msg-list-menu"),f=e.cssAll("#msg-list-menu li"),w=e.css("#msg-list"),v=e.id("article"),y=e.once(t=>(e=>!!v&&(v.dataset.articleId=e.id,v.dataset.authorId=e.author_id,v.classList.add("msg"),!0))(t)&&e.toDOM(v,`\n                    <div class="msg">\n                            \x3c!-- \n                            <a href="/${t.path}#m-${t.id}">\n                            --\x3e\n                                <h2 class="title">\n                                    <div>\n                                        ${t.title?t.title:"Thread Root"}\n                                    </div>\n                                    <div class="date" data-utc-time="${t.date}">\n                                        <span>${e.ageNow(t.date)}</span>\n                                    </div>\n                                </h2>\n                            \x3c!-- \n                            </a>\n                            --\x3e\n                        <div class="body">\n                            ${t.body?t.body:""}\n                            <div class="body-footer">\n                                ${t.uri_other?'<a href="'+i.channel.host_url+t.uri_other+'">Read @ '+i.channel.host_url.split("/")[2]+"</a>":""}\n                            </div>\n                        </div>\n                        <div class="meta">\n                            <div class="keywords"></div>\n                        </div>\n                    </div>\n                `)),b={article:t},_=e.cfg.view.svgsPath,T=(e.cfg.view.avatars,n.unitHeight),A=15*T,S=e.nowMsec(),k=1,P=0,x={messages:{full:k,diff:k}},L=[],O={threads:0,messages:0,newest:0,oldest:1/0},E=[],M=()=>{const t=e.cssAll("#msg-list div.msg")||"";[...t].map(t=>{const s=e.css("div.date",t),a=e.css("div.date>span",t);s&&a&&e.setText(a,e.ageNow(s.dataset.utcTime))}),!h&&d("Update Age of all :",t.length,"@",e.nowUTC())},$=e.once(()=>{d("@ onSchUpdateMsgsAge() : LAUNCH");const t=[1,2,5].map(e=>6e4*e);e.aScheduleSeq(e.seqArr(t,0),M)}),C=(e,t,s)=>{f&&f.length&&(e&&(f[0].dataset.count=e),t&&(f[1].dataset.count=t),s&&(f[1].dataset.count="n/a"))},D=()=>{return{messages:e.cssAll("#msg-list div.msg").length,threads:e.cssAll("#msg-list>div.thread").length}},N=e=>{const t=Math.round(w.scrollHeight);return!!(Math.round(.9*t*(1-A/t)-3*T-e)<0)},R={expanded:"collapse",collapsed:"expand"},I=n.cfgMsgs.collapseAll?R.collapsed:R.expanded,F=(e,t)=>{const s=e===R.collapsed?"Expand":"Collapse",a={siblings:0,total:0,html:""};if(t){const e=t=>t&&t[0]&&t.reduce((t,s)=>(s.replies?t+=e(s.replies):t+=0,t),t.length);a.siblings=t?t.length:0,a.total=t?e(t):0,a.total&&(a.html=`${a.siblings}/${a.total}`)}return`\n                    <span class="count-replies">${a.html}</span>\n                    <div class=title data-title="${s}">\n                        <svg>\n                            <use href="${_}#def-${e}"></use>\n                        </svg>\n                    </div>`},U=(e,t,s)=>{if("to_id"in t){const s=e.findIndex(e=>e.id===t.to_id);if(s<0)return t.awaitingRecipient=1,L.push(t),e;e[s].replies?e[s].replies:e[s].replies=[],e[s].replies.push(t),t.redundant=1}return e};return a=>{if(!n.validate.key(a,s)||!a.msg_list||!a.msg_list.list)return!1;const i=e.State(),f=a.msg_list,v=a.msg_list.count||0,A=1,j=2,q=a.channel.chn_id,B=a.owner.user_id,H=a.msg_list.type,G=(e.lTypeName(H),H===e.lTypes.chn?q:H===e.lTypes.th?b.article&&b.article.id||f.list[0].id:B),V=t=>H>e.lTypes.th?["ml","top",e.lTypeName(H),t]:["ml",e.lTypeName(H),G,t],W=H===e.lTypes.th,J=m?{wanted:!(!a.msgListMenu||!a.msgListMenu.want)&&("Threads"!==a.msgListMenu.want&&!!a.msgListMenu.want),state:"Oldest"==m.dataset.state||"Newest"==m.dataset.state?m.dataset.state:""}:{wanted:!1,state:!1},z=0===a.mode,X=()=>i.logs[i.logs.length-1].mode===e.aModes.replay&&i.logs.length-1!==a.cursor,K=g?' target="_blank"':"",Y=t=>{const s=`\n                            data-thread-collapsed="${t.replies?"true":""}"\n                            data-self-collapsed="${t.to_id?"true":""}"\n                            `,a=e=>e===R.collapsed?[s,F(I,t.replies)]:e===R.expanded?['\n                            data-thread-collapsed=""\n                            data-self-collapsed=""\n                            ',F(I)]:["FAIL@toggle(state)[0]","FAIL@toggle(state)[1]"],o=t.date>S?" new":"";return`\n\n                    \x3c!-- Thread \n                         @ m-${t.id} \n                         @ c-${t.chn_id} \n                    --\x3e\n                    <div \n                        id="m-${t.id}" \n                        class="thread${t.to_id?" reply":""}${z?"":o}${(e=>W&&b.article&&b.article.id===e.id?" single-thread":"")(t)}" \n                        data-chn-id="${t.chn_id}"\n                        data-thread-replies="${t.replies?"true":""}"\n                        data-author-id="a-${t.author_id}" \n                        data-author-display="${t.author_display}" \n                        data-author-handle="${t.author_handle}" \n                        ${a(I)[0]}\n                    >\n                        <div ${b.article&&b.article.id===t.id?'id="msg-zero"':""}\n                            class="msg"\n                            data-punished="${t.tokens_q<0?"true":""}">\n                            <div class="graphics">\n                                <div>\n                                    <img src="${t.author_avatar?n.avatar(t.author_avatar):n.avatarMBF(t.author_handle)}" alt="">\n                                    <div class=badges>${t.author_badges?e.makeBadgeNodes(t.author_badges).join(" "):""}</div>\n                                </div>\n                            </div>\n                            <div class="main">\n                                \n                                    ${t.title?'<a class="msg-title" href="/m/thread/'+t.id+'"'+K+"><h2>"+t.title+" <span>&nbsp;&#x25b6</span></h2></a>":""}\n                               \n                                <h3>\n                                    <div class="author">\n                                        ${t.uri_local&&t.uri_local!==window.location.pathname?'<a href="'+t.uri_local+"#m-"+t.id+'"'+K+">"+t.author_display+" <span>/"+t.author_handle+"</a>":'<a href="/'+t.author_handle+"/pub#m-"+t.id+'"'+K+">"+t.author_display+" <span>/"+t.author_handle+"</a>"}\n                                        ${t.to_id?'<div><a href="/'+t.to_handle+"/pub#m-"+t.to_id+'"'+K+">Reply to /"+t.to_handle+"</a></div>":""}\n                                    </div>\n                                    <div>\n                                        ${t.to_id||t.title?"":'<a href="/m/thread/'+t.id+'" class="button"'+K+">&nbsp;&#x25b6</a>"}\n                                    </div>\n                                    <div class="date" data-utc-time="${t.date}">\n                                        <span>${e.ageNow(t.date)}</span>\n                                    </div>\n                                </h3>\n                                <div class="body">\n                                    <p>\n                                        ${t.form===e.mForm.short?t.body:t.summary?t.summary:""} \n                                        \x3c!-- | m-${t.id.substring(0,7)} --\x3e\n                                    </p>\n                                    <p class="sponsor ${t.sponsub?"":"hide"}">\n                                        ${t.sponsub}<span>P</span>\n                                    </p>\n                                </div>\n                                <div class="options">\n\n                                    <div class="actions">\n                                        ${t.tokens_q<0?(e=>`\n                            <div class="yea">\n                                ${e.to_id?`\n                                <div class="title" data-title="Punish">\n                                    <svg>\n                                        <use href="${_}#def-punish"></use>\n                                    </svg>\n                                    <span></span>\n                                </div>`:""}\n                                <div class="title" data-title="qToken">\n                                    <svg>\n                                        <use href="${_}#def-token-q"></use>\n                                    </svg>\n                                    <span>${e.tokens_q?e.tokens_q:""}</span>\n                                </div>\n                                <div \n                                    class="title${e.tokens_q<n.minMsgQ4P&&0===e.tokens_p?" hide":""}" \n                                    data-title="pToken">\n                                    <svg>\n                                        <use href="${_}#def-token-p"></use>\n                                    </svg>\n                                    <span>${e.tokens_p?e.tokens_p:""}</span>\n                                </div>\n                            </div>\n                            `)(t):(e=>`\n                            <div class="yea">\n                                <div class="title" data-title="qToken">\n                                    <svg>\n                                        <use href="${_}#def-token-q"></use>\n                                    </svg>\n                                    <span>${e.tokens_q?e.tokens_q:""}</span>\n                                </div>\n                                <div \n                                    class="title${e.tokens_q<n.minMsgQ4P&&0===e.tokens_p&&(!b.article||b.article.id!==e.id)?" hide":""}" \n                                    data-title="pToken">\n                                    <svg>\n                                        <use href="${_}#def-token-p"></use>\n                                    </svg>\n                                    <span>${e.tokens_p?e.tokens_p:""}</span>\n                                </div>\n                            </div>\n                            `)(t)+(e=>p?'\n                            <div class="pub">\n                            </div>\n                            ':`\n                            <div class="pub">\n                                <div class="title" data-title="Reply">\n                                    <svg class="reply">\n                                        <use href="${_}#def-reply-open"></use>\n                                    </svg>\n                                </div>\n                                \x3c!-- Not yet implemented --\x3e\n                                <div class="title hide" data-title="Repost">\n                                    <svg>\n                                        <use href="${_}#def-repost"></use>\n                                    </svg>\n                                </div>\n                            </div>\n                            `)()+(e=>`\n                            <div class="non">\n                                ${e.to_id?`\n                                <div class="title" data-title="Punish">\n                                    <svg>\n                                        <use href="${_}#def-punish"></use>\n                                    </svg>\n                                    <span></span>\n                                </div>`:""}\n                            </div>\n                            `)(t)}\n                                    </div>\n\n                                    <div class="toggle" data-msg-ref="m-${t.id}">\n                                        ${t.replies?a(I)[1]:""}\n                                    </div>\n\n                                </div>\n                            </div>\n                        </div>\n                        \n                        ${t.replies?(e=>`\x3c!-- id="m-${e}" has replies (recurse). --\x3e`)(t.id):""}\n                        ${t.replies?t.replies.map(Y).join(""):""}\n                    </div>\n                    \x3c!-- END Thread @ m-${t.id.substring(0,7)} --\x3e\n`};function Q(){if(f.format!==A)return c("@ state #",a.cursor,": perMessage() : msgs.format :"+`${f.format} (MISMATCHED)`),!1;x.messages.diff=P;const s=f.list,i=[],u=f.list[0]&&f.list[0].date||e.nowMsec(),g=f.list[0]&&f.list[f.list.length-1].date||e.nowMsec(),m=!!(u>O.newest);var y;O.oldest=u>O.oldest?O.oldest:u,O.newest=g<O.newest?O.newest:g,f.list=[],x.messages.diff=k,(()=>{e.aSchedulerP.signal;const c=z||J.state?n.dtReplayRender:260,g={count:0,max:7},f={new:0,reply:0},b={acc:0,max:0,last:0,trigger:T},_=(e,t)=>{var s;return e===c?(s=f.new,t?f.new+=1:f.new-=1):(s=f.reply,t?f.reply+=1:f.reply-=1),s*e},A=e=>(_(e.wType),e.msg&&(i.push(e.msg.id),O.messages++,i.length<=s.length&&!h&&d("#",a.cursor,"@ dispenseMessages() :","(",i.length,"/",s.length,")",10===e.wType?"Reply":"New")),e),S=s=>{if(i.includes(s.id))return t;var a=!1;const n=e.css(`#m-${s.to_id}`,w),o=e.css(`#m-${s.to_id} .toggle[data-msg-ref=m-${s.to_id}]`,n),r=e.css(`#m-${s.to_id} .count-replies`);return o&&!r&&!p&&e.toDOM(o,F(R.collapsed,s.replies)),n&&e.toDOM(n,Y(s))||e.toDOM(w,Y(s))&&(a=!0),p&&$(s),n||a?s:t},E=s=>i.includes(s.id)?t:(e.toDOM(w,Y(s),y),p&&$(s),s),$=t=>e.toDOM(e.css(`#m-${t.id} .toggle[data-msg-ref=m-${t.id}]`)),I=s=>i.includes(s.id)?t:J.state&&"Oldest"!==J.state&&g.count++>=g.max?t:void(s.to_id&&!J.state?e.aSchedulerP(_(10,!0),S)(s).then(e=>A({msg:e,wType:10})):e.aSchedulerP(_(c,!0),E)(s).then(e=>A({msg:e,wType:c}))),U=()=>{x.messages.diff=P,s.map(I),x.messages.diff=k,e.aDelay(n.dtReplayRender*(D().messages+1),M)},j=e.throttle(200,()=>{X()&&(s.length=0),window.scrollY<b.max||(g.count=0,b.max=window.scrollY,b.acc+=b.max-b.last,b.acc>b.trigger&&(N(b.max)&&U(),b.acc=0),b.last=b.max,b.acc<0&&(b.acc=0),i.length<s.length?(O.oldest>u&&"Oldest"!==J.state&&o.pub(r.View,{node:w,dType:J.state?e.dTypes.diff:e.dTypes.full,want:["older"],uri:V(u)}),!h&&d("#",a.cursor,"@ perMessage() :",i.length,"/",s.length,"(rendered/total)","|",O.messages,"acc","|",s.length-i.length,"UNRENDERED.")):(window.removeEventListener("scroll",j),o.pub(r.View,{node:w,dType:e.dTypes.diff,want:["reset"]}),l("#",a.cursor,"@ perMessage() :",i.length,"/",s.length,"(rendered/total)","|",O.messages,"acc","| RENDERED ALL messages of state","#",a.cursor),!h&&e.aDelay(1e3,()=>d("#",a.cursor,": DOM @ perMessage() :",D()))))});H===e.lTypes.pub&&(e.arrsConcat(s,L),l("#",a.cursor,"@ perMessage() > ABSORB list of awaiting-recipients :",L.length,"threads."),L.length=0,s.sort((e,t)=>e.date-t.date)),y=!J.state,m&&"Oldest"===J.state&&(y=!0),!y&&"Oldest"===J.state&&s.sort((e,t)=>t.date-e.date),p&&"Oldest"!==J.state&&s.sort((e,t)=>t.tokens_p-e.tokens_p?t.tokens_p-e.tokens_p:t.tokens_q-e.tokens_q),U(),C(v,O.threads,J.wanted),window.addEventListener("scroll",j)})()}0===a.cursor&&a.view.type===e.vTypes.page&&e.purge(w),z&&(t=>{E.map(e=>clearTimeout(e)),e.aSchedulerP.abort(),e.purge(w),L.length=0,O.threads=0,O.messages=0,O.oldest=1/0,t&&t.msgListMenu&&t.msgListMenu.want&&"Threads"===t.msgListMenu.want?t.dType=e.dTypes.full:t.dType=e.dTypes.diff})(a),0===a.cursor&&!p&&o.pub(r.View,{dType:e.dTypes.diff,want:["newer"],uri:V(O.newest)}),J.state||a.dType!==e.dTypes.full&&(O.messages||O.threads)?e.waitUntil(()=>x.messages.diff,e.seq125(),Q):e.waitUntil(()=>x.messages.full,e.seq125(),(function(){if(x.messages.full=P,e.arrsConcat(f.list,L),L.length=0,0===f.list.length)return d("@ perThread() : NO MESSAGES in this state."),void(x.messages.full=k);const t=[],s=f.list[0].date;var n=[];switch(f.format){case A:if(n=f.list.reduce(U,f.list).filter(e=>1!==e.redundant&&1!==e.awaitingRecipient),H!==e.lTypes.pub&&H!==e.lTypes.sub||L.forEach((e,t)=>e.chn_id!==q&&e.author_id===B&&(n.push(e),L.splice(t,1))),n.sort((e,t)=>e.date-t.date),H===e.lTypes.th){const e=n[0]&&W?b.article?b.article:n[0]:{};e.id&&!b.article&&(e.path=i.key,b.article=e,y(e))}e.arrsConcat(t,n.map(Y)),O.threads+=t.length+L.length;break;case j:n=f.list.filter(e=>!("to_id"in e)),e.arrsConcat(t,n.map(Y));break;default:c("@ state #",a.cursor,": perThread() : msgs.format :"+`${f.format} (INVALID)`)}if(f.list=[],0===t.length)return 0!==L.length&&(Q(),d("@ perThread() : NO RENDERABLE threads. |",L.length,"AWAITING recipients.")),void(x.messages.full=k);x.messages.full=k,(()=>{const n=t.length,i={acc:0,max:0,last:0,trigger:T},c=s=>{if(!O.messages||N(i.max)){if(s){var o=Math.round(s/T+1)||12;o>12&&(o=12);t.length>o||t.length}else afew=t.length<12?t.length:12,o=afew;for(let s=0;s<afew;s++)E.push(e.aDelay(220*s,()=>{x.messages.full=P,u.start("toDOM"),e.toDOM(w,t.pop()),u.stop(),x.messages.full=k}));!h&&d("#",a.cursor,"@ dispenseThreads(",o,") :",t.length,"/",n,"(remain/total) threads. |",L.length,"AWAITING recipients."),!h&&e.aDelay(1e3,()=>d("#",a.cursor,": DOM @ perThread() :",D()))}},p=e.throttle(100,()=>{X()&&(t.length=0),window.scrollY<i.max||(0!==t.length?(i.max=window.scrollY,i.acc+=i.max-i.last,i.acc>i.trigger&&(c(i.acc),i.acc=0),i.last=i.max,i.acc<0&&(i.acc=0)):(window.removeEventListener("scroll",p),L.length?l("#",a.cursor,": perThread() : RENDERED",n,"of",O.threads,"threads. |",L.length,"AWAITING recipients."):l("#",a.cursor,": perThread() : RENDERED ALL",n,"threads of state","#",a.cursor),O.oldest>=s&&o.pub(r.View,{node:w,dType:e.dTypes.full,want:["older"],uri:V(s)}),o.pub(r.View,{node:w,dType:e.dTypes.full,want:["reset"]}),L.length&&Q()))});O.oldest=s>O.oldest?O.oldest:s,c(),C(v,O.threads,J.wanted),window.addEventListener("scroll",p)})()})),$(),window.location.hash&&e.aScheduleSeq(e.seq125(),()=>{const t="m"===window.location.hash.substring(1,2)&&e.css(window.location.hash);t&&t.classList.add("new")}),l("#",a.cursor,"dType :",a.dType,a.msg_list.list.length,"/",v,"(state/cache)")}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){const s=e.View(),a=e.Auth(),n=e.EB(),o=n.eTypes(),r=s.components,i=s.logDeb("txn"),l=s.logErr("txn");s.logFocus("txn");r.txn=(()=>{e.css("#article");const t=e.css("#modal-sponsub"),r=t?{wrapper:e.css(".wrapper",t),heading:e.css(".header H1",t),main:e.css(".main",t),close:e.css(".close",t),submitForm:e.css("#submit",t),submitButton:e.css("#submit BUTTON",t),limit:e.css(".main .fund-source label SPAN B",t),one:e.css("#radio-amount-one",t),two:e.css("#radio-amount-two",t),five:e.css("#radio-amount-five",t),other:e.css("#text-amount-other",t),source:e.css("#check-fund-source",t),sponsor:e.css("#radio-action-sponsor",t),subscribe:e.css("#radio-action-subscribe",t),message:e.css(".main .message TEXTAREA",t)}:{},d=t?{get:function(){return r.message.value},set:function(e){r.message.value=e||""}}:{get:()=>{},set:()=>{}},c=(e.cfg.view&&e.cfg.view.svgLogoDef,e.create("GHOST")),u=t?e.css('.main .action[data-action="subscribe"]',t):c,h=e.css("#channel")||c,p=e.css("#overlay-2")||c,g=s=>{s||f(),d.set(),t.removeEventListener("keyup",e.debounce(100,v)),t.removeEventListener("click",e.debounce(200,y)),t.classList.add("hide"),h.classList.remove("blur"),r.close.classList.add("rotate"),p.style.display="none",u.classList.remove("hide")},m={channel:{},valid:!1,virgin:!0,gw:!1,limit:0,psp:{},txn:{},x:{}},f=()=>{m.valid=!1,m.virgin=!0,m.gw=!1,m.limit=0,m.txn={},m.x={}},w=()=>{const e=Math.floor(+m.txn.amount/m.channel.sub_rate*4.33)+Math.floor(+m.txn.amount/m.channel.sub_rate-1);m.txn.amount&&(r.heading.innerHTML=`\n                    ${+m.txn.amount} <span class="token">P</span> buys ${e} weeks\n                `)},v=e=>{r.other.value&&[r.one,r.two,r.five].map(e=>e.checked=!1),_(),w(),m.virgin&&(r.other.placeholder="",m.virgin=!1),_(),m.valid&&i("@ doKeyUp : valid state:",m)},y=e=>{[r.one,r.two,r.five].map(e=>!0===e.checked&&(r.other.value="")),_(),w();const t=`I appreciate your ${(1==+m.x.xis?"message":2==+m.x.xis&&"channel")||3==+m.x.xis&&"channels"}.`;d.get()||d.set(t),m.valid&&"BUTTON"===e.target.nodeName&&A()},b=e=>e||10,_=()=>{m.valid=!1,r.other.checkValidity()?(r.other.classList.remove("invalid"),m.txn.amount=r.other.value,m.valid=!0):(r.other.classList.add("invalid"),m.valid=!1),r.other.value||(m.valid=!1,[r.one,r.two,r.five].map(e=>{!0===e.checked&&(m.txn.amount=e.value,m.valid=!0)})),!0===r.source.checked?(m.gw=!1,T(m.limit)):(m.gw=!0,T(2*b(m.psp.lastMax))),m.gw?m.txn.amount>2*b(m.psp.lastMax)?(m.valid=!1,r.other.classList.add("invalid"),r.limit.classList.add("invalid")):r.limit.classList.remove("invalid"):m.txn.amount>m.limit?(m.valid=!1,r.other.classList.add("invalid"),r.limit.classList.add("invalid")):r.limit.classList.remove("invalid"),[r.sponsor,r.subscribe].map(e=>!0===e.checked&&(m.x.act=e.value)),m.valid?(r.submitButton.disabled=!1,r.submitButton.classList.remove("disabled")):(r.submitButton.disabled=!0,r.submitButton.classList.add("disabled"))},T=t=>e.setText(r.limit,t),A=()=>{m.txn.amount=+m.txn.amount,m.x.tokens_p=+m.txn.amount,m.x.act=+m.x.act,m.txn.msg=d.get(),g(!0),n.pub(o.Modal,m.x)},S=e.once(()=>{t.addEventListener("keyup",e.debounce(100,v)),t.addEventListener("click",e.debounce(200,y))}),k={msgList:e.css("#msg-list"),owner:e.css("#owner-chn-buttons")},P=t=>{const r=t.body;if(!r||!r.txn_id||!r.tokens_q&&!r.tokens_p)return t.meta.status&&(t.meta.status>=400||111===t.meta.status)&&m.txn.actionNode.classList.add("warn"),Promise.reject({why:"Transaction failed.",what:{resp:t,txn:m.txn},where:"postTxnHandler(..)"});const d=e.css(`#m-${r.xid}`),c=e.css(".actions",d),u=e.css(".title[data-title=qToken]",c),h=e.css(".title[data-title=pToken]",c),p=e.css(".title[data-title=Punish]",c),g={qToken:e.css("SPAN",u),pToken:e.css("SPAN",h),Punish:e.css("SPAN",p)},f=e=>e.body?e.body:Promise.reject(e.meta),w=t=>(((t,s)=>{var a=+e.getText(t);a=a?a+s:s,e.setText(t,`${a}`)})(g[t.action],t.amount),+e.getText(g.qToken)>s.minMsgQ4P&&h.classList.remove("hide"),r),v=t=>(e.setText(g.qToken,t.tokens_q),e.getText(g.qToken)<0&&(()=>{const t=e.css(".yea",c);e.setText(e.css("SPAN",p),""),e.purge(c),e.append(c,t),e.append(t,p),e.append(t,u),e.css(".msg",d).dataset.punished="true"})(),t),y=e=>(n.pub(o.Txn,e),e);switch(i("postTxnHandler(..) : x:",r,"state:",m),!0){case 0===r.act:a.FetchAPI("GET",`/m/${r.xid}`).then(f).then(v).then(y).catch(l);break;case 1===r.act&&r.xis===e.TxnXIS.Message:w(m.txn),a.FetchAPI("GET",`/m/${r.xid}`).then(f).then(y).catch(l);break;case(1===r.act||2===r.act)&&r.xis>=e.TxnXIS.Channel&&(0!==r.tokens_q||0!==r.tokens_p):if(0!==r.tokens_p){var b=b||e.create("GHOST"),_=_||e.css("#owner");const t=_?e.css('.sponsor span[data-title="pToken',_):b;e.toDOM(t,`${r.tokens_p.toLocaleString("en-US")} <em class="thanks">&hellip; Thank you!</em>`)}e.Auth().SubRecordGet(),n.pub(o.View,{dType:e.dTypes.full,want:["channel"],uri:["c",r.xid]})}if(0===r.tokens_p)return t;const T=e.State().store,A=Object.keys(e.lTypes)[T.msg_list.type-1],S=A===e.lTypes.chn?T.channel.chn_id:T.channel.owner_id,k=d?{id:d.id.replace("m-",""),author_display:d.dataset.authorDisplay,author_handle:d.dataset.authorHandle}:article&&T.msg_list&&T.msg_list.oldest_owner_new||T.msg_list&&T.msg_list.newest_owner_new||{},P={form:e.mForm.short,to_id:k.id,to_display:k.author_display,to_handle:k.author_handle,chn_id:T.channel.chn_id,author_id:T.auth.sub,author_display:T.auth.user.display,author_handle:T.auth.user.handle,author_avatar:T.auth.user.avatar||e.cfg.view.avatarDefault,author_badges:T.auth.user.badges,body:m.txn.msg,sponsub:m.txn.amount};return i("msg:",P,"state:",m),a.FetchAPI("POST","/m",P).then(t=>(n.pub(o.View,{dType:e.dTypes.diff,want:["newer"],uri:["ml",A,S]}),t)).then(i).catch(l),t},x=t=>{n.pub(o.Net,{data:{http:{status:t.status,statusText:t.statusText}},mode:e.aModes.promise}),l(t)},L=s=>{const n=(t=>{const s=e.State().store,n={actionNode:void 0,action:void 0,xid:"",xis:"",payee:"",payer:"",amount:0,psp:a.UserPSP(s.auth),msg:""};if(s.auth&&s.auth.sub&&s.auth.r&&e.ttl(s.auth.r.exp)||(n.action="auth-fail"),n.xis=e.TxnXIS.Message,t.matches(".actions .title")&&(n.actionNode=t),t.matches(".actions .title svg")&&(n.actionNode=t.parentNode),t.matches(".actions .title svg use")&&(n.actionNode=t.parentNode.parentNode),n.actionNode||(n.xis=e.TxnXIS.Channel,t.matches('span[data-title="Follow"]')&&(n.actionNode=t),t.matches('span[data-title="Unfollow"]')&&(n.actionNode=t),t.matches('use[href="#def-token-q')&&(n.actionNode=t.parentNode),t.matches('svg[data-title="qToken"]')&&(n.actionNode=t),t.matches('use[href="#def-token-p')&&(n.actionNode=t.parentNode),t.matches('svg[data-title="pToken"]')&&(n.actionNode=t)),!n.actionNode)return n;switch(n.xis){case e.TxnXIS.Channel:n.payee=s.channel.owner_id,n.xid=s.channel.chn_id;break;case e.TxnXIS.Message:const t=e.ancestor(n.actionNode,"DIV.thread");n.payee=e.getID(t.dataset.authorId),n.xid=e.getID(t.id)}switch(n.payer=s.auth.sub,n.payee===n.payer&&"Reply"!==n.actionNode.dataset.title&&"Repost"!==n.actionNode.dataset.title&&(n.action="to-self"),s.auth.user&&0===s.auth.user.tokens_q&&(n.action="out-of-q"),n.action="auth-fail"===n.action||"to-self"===n.action||"out-of-q"==n.action?n.action:n.actionNode.dataset.title,n.action){case"qToken":case"Follow":case"pToken":n.amount=1;break;case"Punish":case"Unfollow":n.amount=-1;break;default:n.amount=0}return n})(s.target),o=n.actionNode&&e.ancestor(n.actionNode,".msg");if(n.actionNode&&(i("onTxn(ev) : txn:",n),!o||"true"!==o.dataset.punished)){switch(!0){case"auth-fail"===n.action:case"to-self"===n.action:case"out-of-q"===n.action:return n.amount=0,void n.actionNode.classList.add("warn");default:n.actionNode.classList.add("heart-beat"),e.aDelay(550,()=>n.actionNode.classList.remove("heart-beat"))}if("Reply"!==n.action&&"Repost"!==n.action){var l={act:9999,xid:n.xid,xis:n.xis,payer_id:n.payer,payee_id:n.payee,tokens_q:0,tokens_p:0,anet:{},csrf:e.rand(22)};switch(n.action){case"Punish":l.act=e.TxnAct.Punish,l.tokens_q=n.amount;break;case"qToken":case"Reward":l.act=e.TxnAct.Sponsor,l.tokens_q=n.amount;break;case"Follow":case"Unfollow":l.act=e.TxnAct.Subscribe,l.tokens_q=n.amount;break;case"pToken":l.act=e.TxnAct.Sponsor,l.tokens_p=n.amount,l.anet={profile_customer_id:n.psp.cid,profile_payment_id:n.psp.pid}}f(),m.txn=n,m.x=l,i("onTxn(..) :",{state:m,x:l,txn:n}),l.tokens_p?(s=>{const a=e.State().store;m.psp=e.Auth().UserPSP(a.auth),m.limit=a.auth&&a.auth.user.tokens_p?a.auth.user.tokens_p:0,m.channel=a.channel,m.owner=a.owner,e.aDelay(350,()=>{if((m.txn.xis===e.TxnXIS.Message||m.txn.xis===e.TxnXIS.Channel&&a.auth.user.subed_recur.includes(a.channel.chn_id))&&(u.classList.add("hide"),r.subscribe.checked=!1,r.sponsor.checked=!0),r.heading.innerHTML=`Monthly Rate: \n                        ${m.channel.sub_rate} <span class="token">P</span>\n                    `,t.classList.remove("hide"),!m.x.anet.profile_customer_id||!m.x.anet.profile_payment_id){const s=e.css(".header H1",t);e.css(".wrapper",t).classList.add("abort"),s.innerHTML='\n                            <a href="/app/profile-buyin" class="button">\n                                Add a Payment Profile\n                            </a>\n                        ',[r.main,r.submitForm].map(e=>e.classList.add("hide")),m.txn.actionNode.classList.add("warn")}r.other.value="",p.style.display="block",r.close.classList.add("rotate"),h.classList.add("blur"),_(),S()})})():O(l)}}},O=e=>{const t=m.gw?"/anet/ss":"/x";a.FetchAPI("POST",t,e).then(P).then(i).catch(x)};return k.keys=Object.keys(k).filter(e=>k[e]&&k[e].id),k.keys.length?(k.keys.map(t=>k[t].addEventListener("click",e.throttle(777,L))),t&&[p,r.close].map(e=>e.addEventListener("click",g)),n.sub(o.Modal,O),e=>{if(!s.validate.key(e,"txn"))return!1;i("published : data.txn:",e.txn)}):function(){}})()}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.css("#channel-post");if(!s)return;e.cfg.view,e.log("chns");const a=e.log("chns",e.log.levels.DEBUG),n=(e.log("chns",e.log.levels.FOCUS),e.log("chns",e.log.levels.ERROR)),o=e.Auth(),r=(e.EB().eTypes(),e.State().store),i=(e.css("DL",s),e.css("DL DT",s)),l=e.css("A",i),d=e.css("H2",i),c=e.cssAll("DD",s),u=e.css("FORM",s),h={chn_id:"",title:e.css("#form-channel-title"),slug:e.css("#form-channel-slug"),about:e.css("#form-channel-about"),rate:e.css("#form-channel-rate"),host_url:e.css("#form-channel-host"),tags:e.css("#form-channel-tags"),privacy:e.cssAll('FIELDSET.privacy INPUT[type="radio"',s)},p=["title","slug","about","host_url","rate"],g=e.css("FIELDSET.rate",s),m=e.css('FORM INPUT[type="submit"]',s),f=e.cfg.view&&e.cfg.view.svgLogoDef,w={chn:{},mode:"",invalid:!0,chnID:""},v=()=>"add"===w.mode&&(w.chn.slug||"...")||"edit"===w.mode&&(h.slug.value||"...")||"...",y=()=>{w.invalid=!1,p.map(e=>h[e].checkValidity()?h[e].classList.remove("invalid"):(h[e].classList.add("invalid"),w.invalid=!0))},b=()=>{w.invalid?(m.classList.add("disabled"),m.disabled=!0):(m.classList.remove("disabled"),m.disabled=!1)},_=e=>`\n            <div class="report">\n                <h3>\n                    Error : <code>${(e=>`${e.meta.statusText} (${e.meta.status})`)(e)} ${e.body&&" : "+e.body.error}</code>\n                </h3>\n            </div>\n        `,T=(t=!1)=>{const s=t.target&&t.target.closest("SPAN")||(()=>{const t=e.create("SPAN"),s=`\n                            <svg>\n                                <use href="${f}"></use>\n                            </svg>`;return e.toDOM(t,s),t})(),a=e.create("DIV");s.classList.add("selected"),a.classList.add("spinner"),e.purge(c[0]),c[0].append(a),a.append(s),e.aDelay(500,()=>a.classList.add("spin"))},A=e=>{switch(e){case"add":w.mode="add",d.dataset.action=w.mode,d.textContent="Add Channel";break;case"edit":w.mode="edit",d.dataset.action=w.mode,d.textContent="Edit Channel"}};if(window.location.hash){const t={title:e.css('FORM FIELDSET.text LABEL[for="form-channel-title"]',s),slug:e.css('FORM FIELDSET.text LABEL[for="form-channel-slug"]',s),host:e.css('FORM FIELDSET.text LABEL[for="form-channel-host"]',s)},a=e=>e.map(e=>{h[e].classList.add("hide"),t[e].classList.add("hide")}),r=t=>{if(!t.body||t.body.chn_id!==w.chnID)return e.purge(c[0]),e.toDOM(c[0],_(t)),Promise.reject({why:"Failed to retrieve channel.",what:{resp:t},where:"respHandler(..)"});h.title.value=t.body.title,h.slug.value=t.body.slug,h.about.value=t.body.about,h.rate.value=t.body.sub_rate,h.host_url.value=t.body.host_url,h.tags.value=t.body.tags,a(["slug"]),("pub"===h.slug.value||"sub"===h.slug.value)&&a(["title","host"]),y(),b()};A("edit"),w.chnID=window.location.hash.substr(1),o.FetchAPI("GET","/c/"+w.chnID).then(r).catch(n)}else A("add");l.addEventListener("click",t=>{if(t.preventDefault(),!t.target.dataset.action)return;if([...c].map(e=>e.classList.toggle("hide")),!r.auth||!r.auth.sub)return e.purge(c[0]),void e.toDOM(c[0],'\n                    <div id="guard-form">\n                        <h3>\n                            <a href="/app/login" class="button">\n                                Requires Login\n                            </a>\n                        </h3>\n                    </div>\n                ');r.auth.user.subed_recur.length<100&&g.classList.add("hide"),d.textContent=`@ /${r.auth.user.handle}/${v()}`;const s=Object.keys(h).filter(e=>"chn_id"!==e&&"privacy"!==e&&!h[e].value);s.length&&h[s[0]].focus()}),u&&u.addEventListener("keyup",e.throttle(100,t=>{const s=t.target.name;if(""!==h.rate.value?h.rate.required=!0:h.rate.required=!1,"rate"===s&&""!==h.rate.value&&(h.rate.value=+h.rate.value),"title"===s&&(["|","\\","^","*","`"].map(t=>h.title.value=e.replaceAll(h.title.value,t,"")),h.title.value=e.replaceAll(h.title.value,"  "," ")),"slug"===s){if("edit"===w.mode)return;["|","\\","(",")","[","]","{","}",">","<","/","%","^","?","@","#","$","&","*",":",";","+","=","--","!","~","`",",",'"',".","''"].map(t=>h.slug.value=e.replaceAll(h.slug.value,t,"")),h.slug.value=e.replaceAll(h.slug.value," ","-"),h.slug.value=e.replaceAll(h.slug.value,"--","-"),h.slug.value=e.replaceAll(h.slug.value,"__","_")}"tags"===s&&(["|","\\","(",")","[","]","{","}",">","<","/","%","^","?","@","#","$","&","*",":",";","+","=","-","_","!","~","`",",,",'"',".","''"].map(t=>h.tags.value=e.replaceAll(h.tags.value,t,"")),h.tags.value=e.replaceAll(h.tags.value," ","")),h[s]&&(w.chn[s]=h[s].value),d.textContent=`@ /${r.auth.user.handle}/${v()}`,y(),b()})),u&&u.addEventListener("submit",t=>{if(t.preventDefault(),u.dataset.idempotent)return;u.dataset.idempotent=e.rand(),T(t);const s=w.chn.host_url?'\n                        or <a href="/app/apikey" class="button">Get API Key</a>\n                    ':"",r=e=>`\n                    <div class="report">\n                        <h3>\n                            <em>${e}</em>\n                            <a href="/app/account"class="button">See Account Page</a>\n                            ${s}\n                        </h3>\n                    </div>\n                `;w.chn.tags&&(w.chn.tags=w.chn.tags.split(","),w.chn.tags=w.chn.tags.map(e=>e.trim()),w.chn.tags=w.chn.tags.filter(e=>e));const i={};return Object.keys(w.chn).map(e=>w.chn[e]&&(i[e]=w.chn[e])),+w.chn.rate&&(i.rate=+w.chn.rate),Object.keys(i).length?(i.csrf=e.rand(22),"edit"==w.mode&&(i.chn_id=w.chnID),a("doSubmit : payload:",i),o.FetchAPI("POST","/c/upsert",i).then(t=>{if(!(t.meta&&+t.meta.status<299))return e.purge(c[0]),e.toDOM(c[0],_(t)),Promise.reject({why:`POST : HTTP response code : ${t.meta.status}`,what:{resp:t},where:"respHandler(..)"});a("resp:",t),e.purge(c[0]),e.toDOM(c[0],r("Success!"))}).catch(n)):(e.purge(c[0]),void e.toDOM(c[0],r("No changes.")))}),m.classList.add("disabled"),y(),b()}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s=e.css("#apikey");if(!s)return;e.cfg.view,e.log("apikey");const a=e.log("apikey",e.log.levels.DEBUG),n=(e.log("apikey",e.log.levels.FOCUS),e.log("apikey",e.log.levels.ERROR)),o=e.Auth(),r=e.EB(),i=r.eTypes(),l=e.State().store,d=(e.css("DL",s),e.css("DL DT",s)),c=(e.css("H2",d),e.css("A",d)),u=e.cssAll("DD",s),h=e.css("FORM",s),p=e.css("FORM FIELDSET.channel H3"),g=e.css("FORM FIELDSET.channel",s),m=e.css('FORM INPUT[type="submit"]',s),f=e.cfg.view&&e.cfg.view.svgLogoDef,w={cid:"",channels:[],mode:"",invalid:!0,resp:{}},v=()=>e.aDelay(200,()=>{[...w.channels].map(e=>!0===e.checked&&(w.invalid=!1,w.cid=e.dataset.cid,p.classList.add("alpha50"))),y()}),y=()=>{w.invalid?(m.classList.add("disabled"),m.disabled=!0):(m.classList.remove("disabled"),m.disabled=!1)},b=e=>`\n            <div class="report">\n                <h3>\n                    Error : <code>${(e=>`${e.meta.statusText} (${e.meta.status})`)(e)} ${e.body&&" : "+e.body.error}</code>\n                </h3>\n                ${403==+e.meta.status&&_()}\n\n            </div>\n        `,_=()=>"\n            <p>\n                 <b>Logout then login again</b> to update your newly-acquired role.\n                 You will then be authorized to get an API key. Pardon the trouble.\n            </p>\n            ",T=t=>{if(t.preventDefault(),t.target.dataset.action)return[...u].map(e=>e.classList.toggle("hide")),l.auth&&l.auth.sub?void 0:(e.purge(u[0]),void e.toDOM(u[0],'\n                    <div id="guard-form">\n                        <h3>\n                            <a href="/app/login" class="button">\n                                Requires Login\n                            </a>\n                        </h3>\n                    </div>\n                '))};r.sub(i.Auth,e.throttle(200,t=>{const r=t.sub?`/cl/owned/${t.sub}`:"";r&&o.FetchAPI("GET",r).then(t=>{if(a("@ getOwnedChns(as) : respHandler(resp) : resp:",t),!(t.body&&t.body.list&&t.body.list.length)||+t.meta.status>=400)return e.purge(u[0]),e.toDOM(u[0],b(t)),Promise.reject({why:"Failed to retrieve channel.",what:{resp:t},where:"respHandler(..)"});t.body.list.map(t=>"pub"!==t.slug&&"sub"!==t.slug&&e.toDOM(g,(e=>`\n                    <label for="c_${e.IDx}">\n                        <input \n                            type="radio" \n                            name="channel" \n                            data-cid="${e.chn_id}" \n                            id="c_${e.IDx}" \n                            value="${e.IDx}">\n                        <span>${e.slug}</span>\n                    </label>\n                `)(t))),w.channels=e.cssAll("FIELDSET.channel INPUT",s)}).catch(n)})),c.addEventListener("click",T),h&&h.addEventListener("click",e.throttle(200,e=>v())),h&&h.addEventListener("submit",t=>{if(t.preventDefault(),h.dataset.idempotent)return;h.dataset.idempotent=e.rand(),((t=!1)=>{const s=t.target&&t.target.closest("SPAN")||(()=>{const t=e.create("SPAN"),s=`\n                            <svg>\n                                <use href="${f}"></use>\n                            </svg>`;return e.toDOM(t,s),t})(),a=e.create("DIV");s.classList.add("selected"),a.classList.add("spinner"),e.purge(u[0]),u[0].append(a),a.append(s),e.aDelay(500,()=>a.classList.add("spin"))})(t);const s=`/c/key/${w.cid}`,r={csrf:e.rand(22)},i=t=>{t.preventDefault();const s=e.id("apikey-got");if(a(t.target,t),"copy"===t.target.dataset.action&&Promise.resolve(e.copyToClipboard(s)).then(()=>t.target.innerHTML="TEXT COPIED"),"download"===t.target.dataset.action){const s=[JSON.stringify(w.resp.body)],a=new Blob(s,{type:"application/json"}),n=`uqrate${w.resp.body.chn_slug?"."+w.resp.body.chn_slug:""}.json`,o=document.createElement("a"),r=URL.createObjectURL(a);o.classList.add("hide"),o.setAttribute("download",n),o.href=r,o.setAttribute("target","_blank"),Promise.resolve(o.click(),e.Delay(1e3)).then(()=>URL.revokeObjectURL(r)).then(()=>t.target.innerHTML="JSON DOWNLOADED")}};return o.FetchAPI("PATCH",s,r).then(t=>(a("doSubmit() : resp:",t),t.body&&t.meta&&t.meta.status<299?(e.purge(u[0]),e.toDOM(u[0],(e=>`\n                    <div class="report success">\n                        <h3>\n                            <code>\n                                <input type="text" id="apikey-got" value="${e.body.key}">\n                            </code>\n                        </h3>\n                        <h4 id="apikey-got-buttons">\n                            <button data-action="copy" class="button copy">Copy key</button> \n                            <button data-action="download" class="button download">Download file</button> \n                        </h4>\n                    </div>\n                `)(t)),w.resp=t,c.removeEventListener("click",T),e.purge(d),e.toDOM(d,'<h2><em class="center alpha50">Store your SECRET key securely.</em></h2>'),!0):(e.purge(u[0]),e.toDOM(u[0],b(t)),Promise.reject({why:`PATCH : HTTP response code : ${t.meta.status}`,what:{resp:t},where:"respHandler(..)"})))).then(()=>{return e.id("apikey-got-buttons").addEventListener("click",e.throttle(200,i))}).catch(n)}),m.classList.add("disabled"),v(),y()}(window[__APP__]=window[__APP__]||{}),function(e,t){"use strict";const s="centre",a=e.css("#centre"),n=e.View(),o=n.components;a&&(o.centre=(()=>{n.logDeb(s),n.logErr(s),n.logFocus(s);const t=e.EB(),o=t.eTypes(),r=(e.State().store,e.css("#channel-header .menu")),i=e.cssAll("#channel-header .menu LI A"),l=e.css("#msg-list-menu"),d=e.cssAll("#app .content>*"),c=e.css("#chn-list"),u=e.css("#msg-list"),h=()=>([...d].map(t=>e.purge(t)),m.idsRendered=[]),p=e.cssAll("LI",l),g=()=>p&&[...p].filter(e=>e.classList.contains("active"))[0].textContent.toLowerCase(),m={model:e.ModelName(e.Models.Message),list:e.ListName(e.Models.Message),ltype:g(),scroll:!1,tag:"",idsRendered:[],length:-1},f=()=>{m.tag="",e.removeHash(),h()},w=t=>e.Models[t]===e.Models.Channel?"cl/top":"ml/top",v=()=>{t.off(o.State,v),m.tag&&window.scrollTo(0,0),m.scroll=!1,t.pub(o.View,{dType:e.dTypes.diff,want:["top"],uri:[w(m.model),m.ltype]})},y=e=>e.owner_about?e.owner_about:e.about,b=["Uncategorized","Column","Latest","Links"],_={Channel:(t,s="")=>(!s||((t,s)=>t.filter(t=>e.replaceAll(t," ","")===s).length)(t.tags,s))&&"sub"!==t.slug&&`\n                    <div class="channel-of-list">\n\n                        <div class="banner${t.owner_banner?"":" hide"}">\n                            <img src="${e.cfg.view.banners}/${(e=>e||"uqrate-banner.webp")(t.owner_banner)}">\n                        </div>\n\n                        <div class="main">\n                            <div class="head">\n                                <div class="avatar hide">\n                                    <img src="${e.cfg.view.avatars}/${(e=>e||"uqrate-avatar.png")(t.owner_avatar)}">\n                                </div>\n                                <h4>\n                                    <a href="/${t.owner_handle}/${t.slug}">${t.owner_handle}/${t.slug}</a>\n                                </h4>\n                            </div>\n                            <p>\n                                ${"proxy"!==y(t)?y(t):"This channel mirrors the blog."}\n                            </p>\n                            <div class="tags${t.tags.length?"":" hide"}">\n                                ${((t=[],s="")=>t.filter(e=>!b.includes(e)).map(t=>`\n                <span>\n                    <a \n                        class="${e.replaceAll(t," ","")===s?"bold":""}"\n                        href="#${e.replaceAll(t," ","")}">${t}</a>\n                </span>\n            `))(t.tags,s).join('<span class="sep">|</span> ')}\n                            </div>\n                        </div>\n                    </div>\n                `,Message:e=>`<h4>${e.idx} by ${e.author_handle} @ ${e.date}</h4>`};return n.validate.node(a,"#centre")?([...i].filter(e=>!e.classList.contains("active")).map(e=>[...d].map(t=>e.dataset.model===t.dataset.model&&t.classList.add("hide"))),h(),t.sub(o.State,v),r&&r.addEventListener("click",t=>(f(),!!t.target.dataset.model&&(m.model=t.target.dataset.model,m.list=e.ListName(e.Models[t.target.dataset.model]),m.ltype=g(),v()))),l&&l.addEventListener("click",e=>(f(),(e=>{"LI"===e.nodeName&&([...p].map(e=>e.classList.remove("active")),e.classList.add("active"))})(e.target),m.ltype=g(),v())),a.addEventListener("click",t=>{"A"===t.target.nodeName&&(t.target.classList.contains("active")||e.aDelay(10,()=>(window.location.hash&&(m.tag=window.location.hash.substring(1)),v())))}),a=>{if(!n.validate.key(a,s))return!1;if(!a.list||!a.list.length)return!0;if(a.active.model===e.ModelName(e.Models.Message))return!0;const r=a.list[0].date,i=a.list[a.list.length-1].date,l=r-i>0?i:r,d=()=>{e.scrollPagePct()<90||m.ltype===e.lTypeName(e.lTypes.newest)&&(m.scroll=!0,window.removeEventListener("scroll",d),t.pub(o.View,{dType:e.dTypes.diff,want:["top"],uri:[w(m.model),m.ltype,l,50]}))},p=(m.model,e.ModelName(e.Models.Channel),m.model===e.ModelName(e.Models.Channel)?c:u);!m.scroll&&h(),m.ltype===e.lTypeName(e.lTypes.newest)&&i>r&&a.list.sort((e,t)=>t.date-e.date),a.list.map((t,s)=>((t,s,a)=>{m.idsRendered.includes(s.id)||(e.rIC(()=>e.toDOMrAF(t,_[m.model](s,m.tag)),500*a),m.idsRendered.push(s.id))})(p,t,s)),m.length!==m.idsRendered.length&&window.addEventListener("scroll",d),m.length=m.idsRendered.length}):function(){}})())}(window[__APP__]=window[__APP__]||{}),function(e,t){const s=e.log("A2HS",e.log.levels.INFO),a=(e.log("A2HS",e.log.levels.ERROR),e.log("A2HS",e.log.levels.DEBUG),e.log("A2HS",e.log.levels.FOCUS)),n=(e.log.debugOFF,(0,e.css)("#a2hs")),o={defer:void 0};n&&window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),o.defer=e,n.classList.remove("hide"),a("@ beforeinstallprompt :",e),n.addEventListener("click",e=>{a("@ click :",e),n.classList.add("hide"),o.defer.prompt(),o.defer.userChoice.then(e=>{"accepted"===e.outcome?s("user ACCEPTED"):s("user REJECTED"),o.defer=null})})})}(window[__APP__]=window[__APP__]||{}),function(e,t){window.addEventListener("beforeunload",()=>window.scrollTo(0,0)),window.addEventListener("load",()=>{if(void 0===e.cfg||void 0===e.cfg.loader)return void console.log("@ Loader : FAIL @ cfg");e.log("Loader");const t=e.log("Loader",e.log.levels.DEBUG),s=(e.log("Loader",e.log.levels.FOCUS),e.log("Loader",e.log.levels.ERROR),e.cfg.loader),a=e.EB(),n=a.eTypes(),o=(e.filltext,e.cfg.view&&e.cfg.view.svgLogoDef,e.css("#view")),r=e.Page(),i=l=>{const d=e.State().get(l);if(d.channel)if(a.off(n.State,i),(e=>!(!e||-1===r.referrer.indexOf(e)))(d.channel.host_url))(s=>{const a=e.EB(),i=e=>r.parent.postMessage(e,r.referrer),l=()=>({referrer:r.referrer,height:o.clientHeight,state:{key:s.key,channel:s.channel}});(()=>e.aScheduleSeq(e.seq125(200),()=>i(l())))(),a.sub(n.View,t=>("toggleFormRequest"===t.arg||"toggleThreadFired"===t.arg)&&e.aDelay(100,()=>i(l()))),window.addEventListener("message",e=>{if(r.top!==e.source)return;(e=>e?{chnOwner:e.chnOwner,chnSlug:e.chnSlug,msgId:e.msgId,msgTitle:e.msgTitle,msgSummary:e.msgSummary,chnId:e.chnId}:void 0)(e.data.dataset);t("Got msg from PARENT :",{data:e.data,top:r.top,ev:{origin:e.origin,source:e.source,target:e.target}})},!1)})(d);else{t("state :",d);const e=JSON.stringify({comment:"404"===d.channel.slug?"Parent article NOT FOUND":"Channel host-referrer MISMATCH",referrer:r.referrer,chnHostURL:"404"===d.channel.slug?"N/A":d.channel.host_url||"NONE",replies:"404"===d.channel.slug?"404 (Not Found)":"N/A"},null,"\t");o.innerHTML=`\n                        <div class="iframe-guard">\n                            <a target="_parent" href="${s.origin}">\n                                <svg>\n                                    <use href="#def-uqrate-banner"></use>\n                                </svg>\n                            </a>\n                            <p>\n                                Speak your mind,<br>\n                                mind your <span>P</span>s and <span>q</span>s,<br>\n                                and <b>prosper</b>.\n                            </p>\n                            <div class="pre">\n                                <pre>obj: ${e}</pre>\n                            </div>\n                        </div>\n                    `}};r.embedded&&([e.css("HEADER"),e.css("FOOTER"),e.id("article"),e.css("#owner .banner"),e.css("#owner .channel H3"),e.css("#owner .channel P"),e.css("#owner .badge")].map(e=>e&&e.classList.add("hide")),r.embedded&&o.classList.add("iframe-grayscale"),a.sub(n.State,i)),a.pub(n.Loader,{want:["init"]}),t(""),t("is @ iframe :",r.embedded&&r)})}("undefined"!=typeof window&&(window[__APP__]=window[__APP__]||{})||"undefined"!=typeof global&&(global[__APP__]=global[__APP__]||{}));
